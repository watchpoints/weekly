问：
liunx read write buffer大小是 I/O block大小吗 他们之间什么关系？

用FIO工具测试 WRITE: bw=1M 结果 1986MiB/s 
但是read write程序测试 buffer=32M  iotop看32M/s

结果：read write 性能很慢呀

umount /dev/nvme1n1
umount /dev/nvme2n1
umount /dev/nvme3n1

mkfs.ext4 /dev/nvme1n1
mkfs.ext4 /dev/nvme2n1
mkfs.ext4 /dev/nvme3n1
 
mount  dev/nvme1n1   /data/beegfs/beegfs_storage301
mount  /dev/nvme2n1 /data/beegfs/beegfs_storage302
mount  /dev/nvme3n1 /data/beegfs/beegfs_storage303



beegfs-ctl --storagebench --alltargets --write --targetids=201 --blocksize=512K --size=10G


主要问题是
fio 测试磁盘性能是1G,但是 代码 read write 很慢


fio --name=test2_1G.txt \
    --directory=/mnt/beegfs/   \
    --rw=write --refill_buffers \
    --bs=256K  --size=1G




SSD测试第一神器——FIO
Performance benchmarking with Fio 
http://www.ssdfans.com/?p=6087

ob_global_start_proxy.cpp
dd if=/dev/zero of=wang1.txt  bs=1M count=10
dd if=/dev/zero of=tmp.10G  bs=1M count=1000
dd if=/dev/zero of=tmp.1G  bs=1G count=1


beegfs-ctl --migrate --storagepoolid=2--destinationpoolid=1 /mnt/beegfs/tmp.10G

What is the difference between Python's multiprocessing module and MPi4Py?
 
hostnamectl set-hostname h12-meta01

管理节点: 10.141.162.40

mkdir -p /data/beegfs/beegfs_mgmtd (普通目录 不需要挂载点)

/opt/beegfs/sbin/beegfs-setup-mgmtd -p /data/beegfs/beegfs_mgmtd

systemctl start beegfs-mgmtd
systemctl status beegfs-mgmtd


元数据： 10.141.162.40

yum install beegfs-meta libbeegfs-ib 
yum install beegfs-mgmtd
yum install beegfs-storage libbeegfs-ib
systemctl stop firewalld 
systemctl disable firewalld
vi /etc/selinux/config
mkdir -p /data/beegfs/beegfs_meta

mkfs.ext4  /dev/nvme0n1

mount  /dev/nvme0n1 /data/beegfs/beegfs_meta

/opt/beegfs/sbin/beegfs-setup-meta -p /data/beegfs/beegfs_meta -s 1 -m 10.141.162.40 -f
  
systemctl start beegfs-meta
systemctl status beegfs-meta

Failed to resolve hostname. hostname:  10.141.162.40; System error: Name or service not known (Name Resolution Error: -2)



存储节点1：10.141.162.13
yum install beegfs-storage libbeegfs-ib
yum install beegfs-client beegfs-helperd beegfs-utils

mkdir -p  /data/beegfs/beegfs_storage101
mkdir -p  /data/beegfs/beegfs_storage102
mkdir -p  /data/beegfs/beegfs_storage103

mkfs.ext4 /dev/sdc
mkfs.ext4 /dev/sdd
mkfs.ext4 /dev/sde
 
mount  /dev/sdc  /data/beegfs/beegfs_storage101
mount  /dev/sdd /data/beegfs/beegfs_storage102
mount  /dev/sde /data/beegfs/beegfs_storage103

/opt/beegfs/sbin/beegfs-setup-storage  -p /data/beegfs/beegfs_storage101 -s 1 -i 101 -m 10.141.162.40
/opt/beegfs/sbin/beegfs-setup-storage  -p  /data/beegfs/beegfs_storage102 -s 1 -i 102
/opt/beegfs/sbin/beegfs-setup-storage -p   /data/beegfs/beegfs_storage103 -s 1 -i 103


存储节点2 ：10.141.162.40

mkdir -p /data/beegfs/beegfsstor——age201
mkdir -p /data/beegfs/beegfs_storage202
mkdir -p /data/beegfs/beegfs_storage203

mke2fs - create an ext2/ext3/ext4 filesystem
mkfs.ext4  /dev/nvme1n1
mkfs.ext4  /dev/nvme2n1
mkfs.ext4  /dev/nvme3n1

mount  /dev/nvme1n1  /data/beegfs/beegfs_storage201
mount  /dev/nvme2n1  /data/beegfs/beegfs_storage202
mount  /dev/nvme3n1  /data/beegfs/beegfs_storage203

systemctl start beegfs-storage
systemctl status beegfs-storage

To add a second storage target on this same machine:

/opt/beegfs/sbin/beegfs-setup-storage -p /data/beegfs/beegfs_storage201 -s 2 -i 201 -m 10.141.162.40 -f 
/opt/beegfs/sbin/beegfs-setup-storage  -p /data/beegfs/beegfs_storage202 -s 2 -i 202
/opt/beegfs/sbin/beegfs-setup-storage -p  /data/beegfs/beegfs_storage203 -s 2 -i 203 -f

systemctl status beegfs-storage
/etc/beegfs/beegfs-storage.conf

systemctl start beegfs-storage
///////////////////

beegfs-ctl --listnodes --nodetype=meta --nicdetails
beegfs-ctl --listnodes --nodetype=storage --nicdetails
beegfs-ctl --listnodes --nodetype=client --nicdetails

管理节点

mkdir -p /data/beegfs/beegfs_mgmtd/
mount /dev/sdb /data/beegfs/beegfs_mgmtd/
/opt/beegfs/sbin/beegfs-setup-mgmtd -p /data/beegfs/beegfs_mgmtd



mkdir -p  /data/beegfs/beegfs_mgmtd
mkdir -p /data/beegfs/beegfs_storage
mkdir -p /data/beegfs/beegfs_meta

systemctl start beegfs-storage


client

/opt/beegfs/sbin/beegfs-setup-client -m 10.141.162.40
systemctl start  beegfs-helperd
systemctl start beegfs-client
systemctl status beegfs-client
vim /etc/beegfs/beegfs-mounts.conf


[root@h12-storage01 beegfs]# beegfs-check-servers
Management
==========
h12-meta01 [ID: 1]: reachable at 10.141.162.40:8008 (protocol: TCP)

Metadata
==========
h12-meta01 [ID: 1]: reachable at 10.141.162.40:8005 (protocol: TCP)

Storage
==========
h12-storage01 [ID: 1]: reachable at 10.141.162.13:8003 (protocol: TCP)
h12-meta01 [ID: 2]: reachable at 10.141.162.40:8003 (protocol: TCP)


	
beegfs-ctl --addstoragepool --desc="slow pool" --targets=201,202,203
Pool ID   Pool Description                      Targets                 Buddy Groups
======= ================== ============================ ============================
      1            Default 101,102,103
      2           slow pool 201,202,203


beegfs-ctl --getentryinfo 2
beegfs-ctl --migrate --storagepoolid=1 --destinationpoolid=2  2 
beegfs-ctl --migrate --storagepoolid=1 --destinationpoolid=2  1 


配置：

设置主机名：192.168.192.137hostnamectl set-hostname server01hostnamectl status


  /opt/beegfs/sbin/beegfs-setup-mgmtd -p /data/beegfs/beegfs_mgmtd 


  /opt/beegfs/sbin/beegfs-setup-storage -p /data/beegfs/beegfs_storage -s 1 -i 301 -m 192.168.192.135
  
  /opt/beegfs/sbin/beegfs-setup-meta -p /data/beegfs/beegfs_meta -s 1 -m 192.168.192.135


  
  /opt/beegfs/sbin/beegfs-setup-client -m 192.168.192.135

  systemctl start beegfs-client
  vim /etc/beegfs/beegfs-mounts.conf

启动：


Started Start BeeGFS Client. 


systemctl status beegfs-mgmtd
systemctl status beegfs-storage
systemctl status beegfs-meta
systemctl status beegfs-client





systemctl stop beegfs-mgmtd 
systemctl stop beegfs-meta 
systemctl stop beegfs-storage 
systemctl stop beegfs-helperd 
systemctl stop beegfs-client


scp D:\code\rpm\11\BeeGFS7.3.0.zip  root@10.141.162.94:/root 


/usr/local/bin/bdm-search  -n  3  -B 4096  -a -d " " -o /root/src/beelive/data/query -S 'SELECT path() || (CASE type WHEN "d" THEN "" ELSE "/" || name END) FROM summary WHERE ((1657528098 - mtime) / 60 > 1)' -E 'SELECT path() || (CASE type WHEN "d" THEN "" ELSE "/" || name END) FROM pentries WHERE ((1657528098 - mtime) /  60 > 1)' /root/beegfs

sqlite 拼接字符串

1. python中threading模块对于IO密集型程序有优化作用，对于计算密集型的程序基本没有什么作用 
  【threading模块由于不能充分利用多核CPU舍去】


/usr/local/bin/bdm-search  -n  3  -B 4096  -a -d " " -o /root/src/beelive/data/query -S 'SELECT path() || (CASE type WHEN "d" THEN "" ELSE "/" || name END) FROM summary   ' -E 'SELECT path() || (CASE type WHEN "d" THEN "" ELSE "/" || name END) FROM pentries ' /root/beegfs

/usr/local/bin/bdm-search  -n  4  -B 4096  -a -d " " -o /root/src/beelive/data/query -E 'SELECT path() || (CASE type WHEN "d" THEN "" ELSE "/" || name END) FROM pentries WHERE ((’ + start_time +  "-mtime ) > " + liveTime + + ’)' /root/beegfs



