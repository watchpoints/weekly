





[root@localhost local]# pip3 install tzlocal-4.2-py3-none-any.whl
WARNING: Running pip install with root privileges is generally not a good idea. Try `pip3 install --user` instead.
Processing ./tzlocal-4.2-py3-none-any.whl
Collecting backports.zoneinfo; python_version < "3.9" (from tzlocal==4.2)
  Retrying (Retry(total=4, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<pip._vendor.urllib3.connection.VerifiedHTTPSConnection object at 0x7f87d183c048>: Failed to establish a new connection: [Errno -2] Name or service not known',)': /simple/backports-zoneinfo/
  Retrying (Retry(total=3, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<pip._vendor.urllib3.connection.VerifiedHTTPSConnection object at 0x7f87d183ca20>: Failed to establish a new connection: [Errno -2] Name or service not known',)': /simple/backports-zoneinfo/
  Retrying (Retry(total=2, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<pip._vendor.urllib3.connection.VerifiedHTTPSConnection object at 0x7f87d183c710>: Failed to establish a new connection: [Errno -2] Name or service not known',)': /simple/backports-zoneinfo/
  Retrying (Retry(total=1, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<pip._vendor.urllib3.connection.VerifiedHTTPSConnection object at 0x7f87d183cdd8>: Failed to establish a new connection: [Errno -2] Name or service not known',)': /simple/backports-zoneinfo/
  Retrying (Retry(total=0, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<pip._vendor.urllib3.connection.VerifiedHTTPSConnection object at 0x7f87d183cef0>: Failed to establish a new connection: [Errno -2] Name or service not known',)': /simple/backports-zoneinfo/
^Z





show_path_time_meta(source_path, destination_path , migration_base.PathType.dir_type)
 
 
start_time = time.time()
end_time = time.time()
logging.info("step::times::createindex  >>>>>>>>>>>>>>>>>>{} times: {:.2f} second".format(cmdCreat,end_time - start_time))

这周主要

1. 中国移动整体框架和软连接管理流程了。测试不少问题解决。
2. 管软开发很快，后面开始迁移程序代码。
3. 2个人不在同一个环境开发，他用虚拟机 和用


1.中移迁移程序主要逻辑开发
2.中移联调




问：ob的src\sql\parser\sql_parser_mysql_mode.y 文件需要  lex example5.l
yacc -d example5.y 想这样手工编译吗？
%token <non_reserved_keyword>


9月16号 需要测试功能：
1.策略管理---当文件匹配上多条策略时，按照优先级排序执行
2. 策略管理----策略配置单独写在一个文件里
3.性能统计放在---一个单独文件
  统计：task名字，机器IP 策略内容， 迁移文件数量 文件大小，时间 是否迁移成功
  
4 增加job节点 失败重次数  beegfs-check-servers


9月16号，不需要测试功能(如果有调整在告知)

1. 支持多个功能快池，慢池,目前假设只有一个快池 慢池
2. 增加配置策略语法校验功能
3. 统计管理节点,job-master节点 

///////////////


1. 支持不同快池，慢池配置,启动job时候 需要传递参数[原来假设只有一个块池，慢池] -----【增加一个解析函数】 --【延后做的】
2. 增加配置文件语法校验功能【不给用户提供，内部使用，把解析程序直接拷贝过来】【日志 】
统计管理节点,job-master节点 job-slave节点 名称 机器位置【？？】


需要测试功能：
1.策略管理
 当文件匹配上多条策略时，下按照优先级排序执行[原来只执行一条,]-----[修改一行代码] 
2. 策略单独写在一个配置文件里 ----【增加五行代码】 ---[必做] 【必做 1天】
3.性能统计放在一个文件。【30行代码 调试需要一天时间】  【必做 1天】
4 增加job节点 失败重次数 


1. 支持不同快池，慢池配置,启动job时候 需要传递参数[原来假设只有一个块池，慢池] -----【增加一个解析函数】 --【延后做的】
2. 增加配置文件语法校验功能【不给用户提供，内部使用，把解析程序直接拷贝过来】【日志 】
统计管理节点,job-master节点 job-slave节点 名称 机器位置【？？】




需要测试功能：
1.策略管理
 当文件匹配上多条策略时，下按照优先级排序执行[原来只执行一条,]-----[修改一行代码] 
2. 策略单独写在一个配置文件里 ----【增加五行代码】 ---[必做] 【必做 1天】
3.性能统计放在一个文件。【30行代码 调试需要一天时间】  【必做 1天】
4 增加job节点 失败重次数 


1. 支持不同快池，慢池配置,启动job时候 需要传递参数[原来假设只有一个块池，慢池] -----【增加一个解析函数】 --【延后做的】
2. 增加配置文件语法校验功能【不给用户提供，内部使用，把解析程序直接拷贝过来】【日志 】
统计管理节点,job-master节点 job-slave节点 名称 机器位置【？？】

///////////////////////

1周内可以实现的功能
策略管理
1. 当文件匹配上多条策略时，下·。按照优先级排序执行[原来只执行一条,]-----[修改一行代码] ---[必做]
2. 支持不同快池，慢池配置,启动job时候 需要传递参数[原来假设只有一个块池，慢池] -----【增加一个解析函数】 --【延后做的】
3. 策略单独写在一个配置文件里 ----【增加五行代码】 ---[必做] 【必做 1天】
4. 增加配置文件语法校验功能【不给用户提供，内部使用，把解析程序直接拷贝过来】【日志 】

性能统计：
1.性能统计放在一个文件。【30行代码 调试需要一天时间】  【必做 1天】
统计：task名字，策略内容， 迁移文件数量 文件大小，时间 是否迁移成功


系统维护：？？
1. 统计管理节点,job-master节点 job-slave节点 名称 机器位置【？？】
beegfs-check-servers
2. 增加job节点 失败重次数 【1个小时】



bdm-search  -n 32 -B 4096  -a -d " " -E 'SELECT sum(size)  FROM pentries WHERE  type="f" and nlink =1 AND   (1662528606.0165527 -ctime ) >3' /mnt/storage2/.temp_beegfs_migration/policy1



1. 分级策略管理 我计划融合在迁移程序里面，放到客户端管理 你说有你时间了，临时想的，给我不到一个小时，估计开会了讨论了。很多细节没定下来
2. 还有后面有问题提前说出来，开会时候 不可能马上给你准确的答案， 已经给你90%了，剩余10%不断模糊。需要不断探索。







storage1  storage2  storage2mountlink  tier2mountlink





1.实现:中移动温冷存储开发分级测试和迁移功能
2.项目打包成rpm包格式
3.分析 如何产生项目执行报告统计


} else {
        ret = OB_ERR_WRONG_VALUE_FOR_VAR;
        LOG_ERROR("unexpected type", K(ret), K(in_val));
      }

obclient [test]> SET @@sql_mode = X'00FFFFFF';

ERROR 1232 (42000): Incorrect argument type to variable 'sql_mode'
Incorrect argument type to variable

ERROR 1231 (42000): Variable 'sql_mode' can't be set to the value of ''
ERROR 1231 (42000): Variable 'sql_mode' can't be set to the value of '\x00\xFF\xFF\xFF'
ERROR 1231 (42000): Variable 'sql_mode' can't be set to the value of 'X00FFFFFF'
STR_USER_ERROR[-OB_ERR_WRONG_VALUE_FOR_VAR] = "Variable \'%.*s\' can't be set to the value of \'%.*s\'";

STR_ERROR[-OB_ERR_WRONG_VALUE_FOR_VAR] = "Variable can't be set to the value";
STR_USER_ERROR[-OB_ERR_WRONG_VALUE_FOR_VAR] = "Variable \'%.*s\' can't be set to the value of \'%.*s\'";
	
[root@localhost log]# tail -f observer.log |grep "fail to check"
[2022-09-04 00:14:24.135921] WARN  [SQL.ENG] check_and_convert_sys_var (ob_variable_set_executor.cpp:635) [2382][482][YB427F000001-0005E7D5858D157B] [lt=10] [dc=0] fail to check value(ret=-4016)
[2022-09-04 00:14:24.136171] WARN  [SQL.ENG] set_variable (ob_variable_set_executor.cpp:227) [2382][482][YB427F000001-0005E7D5858D157B] [lt=52] [dc=0] fail to check(ret=-4016, node={variable_name:"sql_mode", is_system_variable:true, set_scope:2, value_expr:{item_type:"T_HEX_STRING", result_type:{meta:{type:"HEX_STRING", collation:"binary", coercibility:"COERCIBLE"}, accuracy:{length:4, precision:-1, scale:0}, flag:1, calc_type:{type:"NULL", collation:"invalid_type", coercibility:"INVALID"}}, expr_info:["IS_CONST", "CNT_CONST"], rel_id:[], value:{"HEX_STRING":"00FFFFFF"}}, is_set_default:false}, *sys_var={sys_var_name:"sql_mode", sys_var_id:15, base_value:{"BIGINT UNSIGNED":4194304}, inc_value:{"EXT":"__OB__NOP__"}, type:"BIGINT UNSIGNED", flags:4291, is_enum_type:false}, value_obj={"HEX_STRING":"00FFFFFF"})



[2022-09-04 00:21:55.515766] INFO  [SERVER] obmp_base.cpp:1237 [2374][466][YB427F000001-0005E7D5815D16B4] [lt=7] [dc=0] send error package.(user_error_code=1231, err=-5145, sql_state="42000", message=Variable 'sql_mode' can't be set to the value of 'character_set_results')




[2022-09-04 00:21:55.515766] INFO  [SERVER] obmp_base.cpp:1237 [2374][466][YB427F000001-0005E7D5815D16B4] [lt=7] [dc=0] send error package.(user_error_code=1231, err=-5145, sql_state="42000", message=Variable 'sql_mode' can't be set to the value of 'character_set_results')




[100%] Built target oceanbase_static
make[2]: *** No rule to make target `deps/oblib/src/liboblib.a', needed by `src/observer/observer'.  Stop.
make[1]: *** [src/observer/CMakeFiles/observer.dir/all] Error 2


obd cluster deploy test -c /data/beegfs/beegfs_storage303/mini-local-example.yaml

obd cluster start test

CREATE TABLE v0 ( v2 VARCHARACTER ( 3 ) PRIMARY KEY , v1 VARCHARACTER ( 26 ) ) COLLATE utf8_general_ci ;
ALTER TABLE v0 ;
SET @@sql_mode = X'00FFFFFF' ;


cp /root/src/oceanbase/build_debug/src/observer/observer /root/.obd/repository/oceanbase-ce/3.1.4-1/6dc748a3c34d9b70cb0a3568f4f6bd62/bin/observer


dir /root/src/oceanbase/
set pagination off 
thread apply all break ob_system_variable.cpp:1448
constexpr int OB_ERR_WRONG_VALUE_FOR_VAR = -5145;
 else {
        ret = OB_ERR_UNEXPECTED;
        LOG_ERROR("unexpected type", K(ret), K(in_val));
      }
	  
	  
[root@h12-storage03 log]# tail -f observer.log |grep "sql_mode"
[2022-09-05 17:10:22.071731] INFO  [SQL] ob_sql.cpp:163 [1353712][466][YB427F000001-0005E7E970845FAA] [lt=9] [dc=0] Begin to handle text statement(trunc_stmt=SET @@sql_mode = X'00FFFFFF', sess_id=3221488412, execution_id=124302)
[2022-09-05 17:10:22.071981] WARN  [SQL.ENG] set_variable (ob_variable_set_executor.cpp:227) [1353712][466][YB427F000001-0005E7E970845FAA] [lt=8] [dc=0] fail to check(ret=-4016, node={variable_name:"sql_mode", is_system_variable:true, set_scope:2, value_expr:{item_type:"T_HEX_STRING", result_type:{meta:{type:"HEX_STRING", collation:"binary", coercibility:"COERCIBLE"}, accuracy:{length:4, precision:-1, scale:0}, flag:1, calc_type:{type:"NULL", collation:"invalid_type", coercibility:"INVALID"}}, expr_info:["IS_CONST", "CNT_CONST"], rel_id:[], value:{"HEX_STRING":"00FFFFFF"}}, is_set_default:false}, *sys_var={sys_var_name:"sql_mode", sys_var_id:15, base_value:{"BIGINT UNSIGNED":4194304}, inc_value:{"EXT":"__OB__NOP__"}, type:"BIGINT UNSIGNED", flags:4291, is_enum_type:false}, value_obj={"HEX_STRING":"00FFFFFF"})
[2022-09-05 17:10:22.072025] INFO  [SERVER] ob_query_retry_ctrl.cpp:460 [1353712][466][YB427F000001-0005E7E970845FAA] [lt=3] [dc=0] check if need retry(client_ret=-4016, err=-4016, retry_type_=0, retry_times=1, multi_stmt_item={is_part_of_multi_stmt:true, seq_num:0, sql:"SET @@sql_mode = X'00FFFFFF'"})
[2022-09-05 17:10:22.072113] WARN  [SERVER] process (obmp_query.cpp:291) [1353712][466][YB427F000001-0005E7E970845FAA] [lt=4] [dc=0] fail execute sql(sql_id="", sql=SET @@sql_mode = X'00FFFFFF', sessid=3221488412, ret=-4016, ret="OB_ERR_UNEXPECTED", need_disconnect=false)
[2022-09-05 17:10:22.072150] TRACE [TRACE]obmp_base.cpp:915 [1353712][466][YB427F000001-0005E7E970845FAA] [lt=5] [dc=0] [err query](TRACE=begin_ts=1662369022071653 2022-09-05 09:10:22.071653|[process_begin] u=0 in_queue_time:23, receive_ts:1662369022071627, enqueue_ts:1662369022071630|[start_sql] u=0 addr:{ip:"127.0.0.1", port:55708}|[query_begin] u=3 trace_id:YB427F000001-0005E7E970845FAA|[before_processor_run] u=11 |[session] u=5 sid:3221488412, tenant_id:1|[parse_begin] u=68 stmt:"SET @@sql_mode = X'00FFFFFF'", stmt_len:28|[cache_get_plan_begin] u=7 |[cache_get_plan_end] u=18 |[transform_with_outline_begin] u=1 |[transform_with_outline_end] u=25 |[resolve_begin] u=25 |[resolve_end] u=39 |[exec_begin] u=18 arg1:false, end_trans_cb:false|[auto_end_plan_begin] u=135 |[auto_end_plan_end] u=0 |[result_set_close] u=0 ret:-4016, arg1:-4016, arg2:0, arg3:-4016, async:false|[exec_end] u=53 |[query_end] u=46 |[process_end] u=20 run_ts:1662369022071667|[process_ret] u=1 process_ret:-4016|total_timeu=475)
     ret = OB_ERR_WRONG_VALUE_FOR_VAR;
      LOG_USER_ERROR(OB_ERR_WRONG_VALUE_FOR_VAR,
          set_var.var_name_.length(),
          set_var.var_name_.ptr(),
          in_val.get_string().length(),
          in_val.get_string().ptr());
		  
OB_ERR_WRONG_TYPE_FOR_VAR
LOG_USER_ERROR(OB_ERR_WRONG_TYPE_FOR_VAR, set_var.var_name_.length(), set_var.var_name_.ptr());

int ObSqlModeVar::do_check_and_convert(ObExecContext& ctx, const ObSetVar& set_var, const ObObj& in_val, ObObj& out_val)

sys_var.check_and_convert

int ObBasicSysVar::check_and_convert
int ObSqlModeVar::do_check_and_convert(ObExecContext& ctx, const ObSetVar& set_var, const ObObj& in_val, ObObj& out_val)
int ObBasicSysVar::check_and_convert_uint_tc_value(
thread apply all break  ob_variable_set_executor.cpp:631


提问：虚函数 sys_var.check_and_convert 执行对应具体是那个函数？
寻找真相：
dir /root/src/oceanbase
set pagination off 
thread apply all break  ob_variable_set_executor.cpp:580 
thread apply all break  ob_variable_set_executor.cpp:631
thread apply all break  ob_system_variable.cpp:1439
cp /root/src/oceanbase/build_debug/src/observer/observer /root/src/observer/bin/

cp /root/oceanbase/build_debug/src/observer/observer /root/observer/bin/

/root/oceanbase/src/share/system_variable/ob_system_variable.cpp

D:\oceanbase/src/sql/engine/cmd/ob_variable_set_executor.cpp

结果：
sys_var.check_and_convert-->ObBasicSysVar::check_and_convert--->oceanbase::share::ObSqlModeVar::do_check_and_convert

下一步行动：
ret = OB_ERR_WRONG_VALUE_FOR_VAR;
int log_ret = OB_SUCCESS;
if (OB_SUCCESS != (log_ret = log_err_wrong_value_for_var(ret, in_val))) {
  LOG_ERROR("fail to log error", K(ret), K(log_ret), K(in_val));
}

obclient [test]> SET @@sql_mode = X'00FFFFFF';
ERROR 1231 (42000): Variable 'sql_mode' can't be set to the value of 'X00FFFFFF'


usr/local/lib64/python3.6


export PATH=$PATH:/usr/lib64/mpich/bin/
export LD_LIBRARY=$LD_LIBRARY:/usr/lib64/mpich/
alias c="source ~/.bashrc"


yum install python36-devel
pip3 install  mpi4py

英文有效期查询方式
1.希赛网-右上角个人中心-学习中心-基本信息-我的报名（或者希赛网app-我的-报名续证）查看你的PMI账号密码
2.用该账号密码登录PMI官网：https://www.pmi.org/ -右上角My pmi（姓名） - Dashboard