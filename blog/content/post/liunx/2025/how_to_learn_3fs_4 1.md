---
title: 深入浅出理解DeepSeek 3FS (3) 步步引导轻松理解内存管理，面试必看
date: 2025-03-31
description: 面试之美
draft: false
tags:
  - 面试之美
  - 架构之美
  - 源码之美
---

🌟 大家好，我是小王同学，

今天带你们一起探秘内存分配的奥秘！

本文主要描述了如何为一个类自定义new实现

1. 大胆猜测，小心求证过程中  
      
    C++的new实现其实是分层设计的：  
    ➤ 第一层：调用C++标准库中的operator new  
    ➤ 第二层：operator new内部调用C语言标准库中的malloc  
    ➤ 第三层：最终由操作系统提供接口完成实际内存分配  
    
    
2. 模块化替换  
    🔧 在实际开发中，灵活替换默认内存分配方案非常关键：  
    ➤ 链接阶段：C++标准库中的operator new被声明为弱符号，用户只要自定义同名的强符号，就能在链接时自动替换！  
    ➤ 运行阶段：通过设置LD_PRELOAD环境变量，可以让自定义的malloc函数以更高的优先级替换原有实现。  
    这种模块化替换机制不仅让开发者能随时调控内存分配策略，更带来无限可能！✨
    
3. 3FS 怎么实现的  
    🚀 3FS的实现方式相当直观：  
    ➤ 通过定义OVERRIDE_CXX_NEW_DELETE编译开关，默认情况下采用operator new调用malloc；  
    ➤ 如果开启开关，自定义分配器，
	- 可能自定义实现的，
	- 可能第三方库的Jemalloc，TCMalloc
    ➤ 项目中定义了一个统一的全局变量gAllocator，用于管理所有内存分配接口；  
    ➤ 对于第三方分配器，通过dlsym动态加载函数地址（如getMemoryAllocatorFunc = (GetMemoryAllocatorFunc)::dlsym(mallocLib, GET_MEMORY_ALLOCATOR_FUNC_NAME)），
    实现了灵活且扩展性极强的内存管理方案。  
    这种设计既清晰又充满智慧，让内存管理不再神秘，而是充满了DIY的乐趣！
    理解如何深刻 ，这也是为选择看3fs原因，其他项目可不会这么清晰

Happy Coding～💖

![](https://money-1256465252.cos.ap-beijing.myqcloud.com/2025/20250401152333.png)



## c++20 新特性
11

老王：需要这个问题的第一性原理 是什么？

小义：我怎么知道 c++20特性是什么，我又不是委员成员，我跟无法和他交流？

老王：
好，那就搜集c++ 大v 博客，研究，书籍，看看他们背后的故事，
并：**追问为什么要引入这些变化**
**只有知道为了什么，用在什么地方，我们才能真正学到这个知识**

小义：从我进入公司时候，项目就这样设计了，
      都是公司其架构师完成的我也不知道为什么这么做？
  
老王： 从开发一个项目遇到实际问题出发，自己遇到实际问题，非别人口述的。








## 参考第一手资料

### 左耳朵耗子

1. https://coolshell.cn/haoel 很多面试官都是看上面题目来面试别人(上面有广告可以理解)
- C++11 中值得关注的几大变化（详解）
1. 左耳朵耗子 专栏 
![97a74bc6ecd6ef8568bb54cca038377.jpg](https://money-1256465252.cos.ap-beijing.myqcloud.com/2025/97a74bc6ecd6ef8568bb54cca038377.jpg)

- 这个文字版本
- https://github.com/zhuxxsherlocked/study-blog/tree/main/%E5%B7%A6%E8%80%B3%E5%90%AC%E9%A3%8E


https://zhuanlan.zhihu.com/p/664752662
# C++20有哪些让你激动不已的新特性？
https://www.zhihu.com/question/423148993



ceph项目
-  [Ceph 性能瓶颈分析与优化 (混合盘篇)](https://my.oschina.net/u/4565392/blog/5130265)、
- https://blog.csdn.net/weixin_43778179
- https://blog.csdn.net/weixin_43778179
- https://github.com/ceph/ceph/blob/main/src/mds/Server.cc#L508

## 链接我 


如果对上面提到c++学习路径 推荐书籍感兴趣 

关注公共号：后端开发成长指南  回复电子书 

如果更进一步交流 添加 微信：wang_cyi


![image.png](https://money-1256465252.cos.ap-beijing.myqcloud.com/2025/20250331222159.png)


我是小王同学，

希望帮你深入理解分布式存储系统3FS更进一步 ，
为了更容易理解设计背后原理，这里从一个真实面试场故事开始的。

### 阅读对象（也是我正在做事情）

#### **1. 目标：冲击大厂，拿百万年薪**

- 想进入一线大厂，但在C++学习和应用上存在瓶颈，渴望跨越最后一道坎。
- ![image.png](https://money-1256465252.cos.ap-beijing.myqcloud.com/2025/20250401094551.png)


    
#### **2. 现状：缺乏实战，渴望提升动手能力**

- 公司的项目不会重构，没有重新设计的机会，导致难以深入理解需求。
    
- 想通过阅读优秀的源码，提高代码能力，从“不会写”到“敢写”，提升C++编程自信。
    
- 需要掌握高效学习和实践的方法，弥补缺乏实战经验的短板。

####  3. 价值：成为优秀完成任务，成为团队、公司都认可的核心骨干。

**优秀地完成任务= 高效能 + 高质量 + 可持续 + 可度量**

 **错误示范**：
- 不少同学工作很忙，天天加班，做了很多公司的事情。
  但是 不是本团队事情，不是本部门事情，领导不认可，绩效不高
- 做低优先级的任务，无法利他，绩效不高
- 招进来最后变成了随时被裁掉的一些征兆
1.  刻意提高工作难度
2. 工作中不公平对待
3. 制造恶性竞争
4. 捧杀