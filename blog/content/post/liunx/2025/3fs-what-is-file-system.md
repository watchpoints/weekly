---
title: ä»é’é“œåˆ°ç‹è€…ç³»åˆ—ï¼š3FSå¦‚ä½•å®ç°ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿ
date: 2025-03-23
description: ä»é’é“œåˆ°ç‹è€…
draft: false
tags:
  - code_reading
---
ä»é’é“œåˆ°ç‹è€…ç³»åˆ—:æ·±å…¥æµ…å‡ºç†è§£DeepSeek 3FS (2)ä»å†…æ ¸åˆ°ç”¨æˆ·æ€æ–‡ä»¶ç³»ç»Ÿçš„è®¾è®¡ä¹‹è·¯


å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°ç‹åŒå­¦ï¼Œ

æœ¬æ–‡å¸Œæœ›å¸®ä½ æ·±å…¥ç†è§£åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿ3FSæ›´è¿›ä¸€æ­¥

- **æ˜µç§°**ï¼š20ç‚¹ä¸‹ç­å°±æ˜¯ä¸€ä»¶å¾ˆå¹¸ç¦äº‹æƒ…
- **æ„¿æ™¯**ï¼šè®©å°å­©éƒ½å¯ä»¥å¬å¾—æ‡‚æˆ‘åœ¨è®²ä»€ä¹ˆã€‚
- **æˆ‘èƒ½æä¾›ä»€ä¹ˆ**ï¼šå¤šé—®è‡ªå·±ä¸€æ¬¡ä¸ºä»€ä¹ˆè¿™æ ·ç”¨
- **ä¸æ˜ç™½çš„ç•™è¨€**ï¼š
1. Wechat/GitHubï¼šwatchpoints




![](https://files.mdnice.com/user/5197/619f94e3-143d-4c87-b967-1bcfdb5f7d62.png)

## ä½œä¸š å®ç° hello world çš„æ–‡ä»¶ç³»ç»Ÿ ï¼Œå¹¶è¯´å‡ºIOæµç¨‹


å‚è€ƒç­”æ¡ˆ 
- https://www.qiyacloud.cn/2021/05/2021-06-07/
- https://github.com/libfuse/libfuse/blob/master/example/hello.c

æ²¡æœ‰FUSEçš„IOæµç¨‹ç¤ºæ„å›¾


![](https://files.mdnice.com/user/5197/3313ee72-057f-4768-8e49-a131d64c3138.png)


![](https://files.mdnice.com/user/5197/8bdff1ff-7384-4b4e-a565-6e0fc5a2db39.png)

å¸¦FUSEçš„IOæµç¨‹ç¤ºæ„å›¾



![](https://files.mdnice.com/user/5197/cfa47aa2-5c69-4251-864e-9cf7ebeef126.png)



![](https://files.mdnice.com/user/5197/882d8f2a-5511-4dd0-8609-3aa9de0cefd7.png)


## ä¸€ã€å¯¼è¯»

ä»é’é“œåˆ°ç‹è€…ç³»åˆ—ï¼šæ·±å…¥æµ…å‡ºç†è§£ DeepSeek 3FSï¼ˆ1ï¼‰

æˆ‘æ•´ç† å¤§æ¨¡å‹è®­ç»ƒ 
- åœ¨checkpointæ—¶å€™å¯¹å¤§çš„æ–‡ä»¶è¯»å†™ï¼Œ
- åœ¨æ‰¹é‡æŸ¥è¯¢çš„æ—¶å€™å¯¹å°æ–‡ä»¶è¯»å†™

ç›®å‰
- è°·æ­Œçš„GFS é€‚åˆ å¤§æ–‡ä»¶é¡ºåºè¯»å†™ï¼Œ
- CephÂ  mds å…ƒæ•°æ® å­˜åœ¨ç“¶é¢ˆ 8kä½œç”¨


å¹»æ–¹ä¸ºä»€ä¹ˆè¦æ3FSï¼Ÿ
AIè®­ç»ƒä¸æ¨ç†çš„ä¸šåŠ¡éœ€æ±‚ï¼Œä¼ ç»Ÿåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿå·²ç»éš¾ä»¥æ»¡è¶³ï¼š
1. æµ·é‡æ•°æ®é¡ºåºè¯»ï¼ˆè¯­æ–™è¾“å…¥ï¼‰
2. æ£€æŸ¥ç‚¹ï¼ˆåˆ†æ­¥éª¤é‡ç®—ï¼‰
3. é¡ºåºå†™ï¼ˆæ¨¡å‹å‚æ•°ä¿å­˜ï¼‰ï¼›
4. éšæœºè¯»



å› æ­¤é‡æ–°å®ç°ä¸€ä¸ªæ–°çš„æ–‡ä»¶ç³»ç»Ÿ



>ä¸è€ƒè™‘åˆ†å¸ƒå¼ï¼Œä¸ªäººç¬”è®°æˆ–è€…è´­ä¹°äº‘ä¸»æœºæ–‡ä»¶ç³»ç»Ÿ
å¦‚ä½•æ”¯æŒå¤§å°æ–‡ä»¶è¯»å†™ï¼Œå¹¶ä¸”æ»¡è¶³é«˜æ•ˆæŸ¥è¯¢




## æé—®ï¼šLinux ç³»ç»Ÿå¯åŠ¨è¿‡ç¨‹

åˆ’é‡ç‚¹ï¼šé‡ç‚¹æ˜¯æ–‡ä»¶ç³»ç»Ÿéƒ¨åˆ†ï¼Œæ‰©å±•è™šæ‹Ÿæœºï¼ˆKVMï¼‰ä¸å†…æ ¸éƒ¨åˆ†ã€‚



![](https://files.mdnice.com/user/5197/f2b0ec1d-bd25-400c-8efe-93668ddd27b9.png)


ç”µè„‘é€šç”µåï¼ŒåŠ è½½ä¸»æ¿ä¸Šçš„BIOS(basic input output system)ç¨‹åº

BIOSæ˜¯ç”µè„‘å¯åŠ¨æ—¶åŠ è½½çš„ç¬¬ä¸€ä¸ªè½¯ä»¶ã€‚
å®ƒæ˜¯ä¸€ç»„å›ºåŒ–åˆ°è®¡ç®—æœºå†…ä¸»æ¿ä¸Šä¸€ä¸ªROMèŠ¯ç‰‡ä¸Šçš„ç¨‹åº

##### bootï¼š
è™šæ‹Ÿæœºï¼ˆKVMï¼‰å¦‚ä½•è®¾ç½®å¼•å¯¼ç¡¬ç›˜é¡ºåº

ä»€ä¹ˆæ˜¯ KVMï¼Ÿ
åŸºäºå†…æ ¸çš„è™šæ‹Ÿæœºï¼ˆKVMï¼‰æ˜¯ LinuxÂ® æ“ä½œç³»ç»Ÿçš„ä¸€ç§å¼€æºè™šæ‹ŸåŒ–æŠ€æœ¯ã€‚å€ŸåŠ© KVMï¼ŒLinux å¯ä½œä¸ºè™šæ‹Ÿæœºç›‘æ§ç¨‹åºè¿è¡Œå¤šä¸ªç‹¬ç«‹çš„è™šæ‹Ÿæœºï¼ˆVMï¼‰

BIOS--ã€‹boot
ç¬¬1å¼•å¯¼é¡ºåºï¼šhard drive ç¡¬ç›˜

ç¬¬2å¼•å¯¼é¡ºåºï¼šcdrom å…‰é©±  ----ã€‹å®‰è£…ç³»ç»Ÿ

ç¬¬3å¼•å¯¼é¡ºåºï¼šremovable device å¯ç§»åŠ¨è®¾å¤‡--ã€‹uç›˜ï¼Œç§»åŠ¨ç¡¬ç›˜  --ã€‹å®‰è£…ç³»ç»Ÿ

ç¬¬4å¼•å¯¼é¡ºåºï¼šNetwork  --ã€‹ä»ç½‘ç»œå¯åŠ¨--ã€‹ç½‘ç»œä¸­å®‰è£…æœåŠ¡å™¨å¯åŠ¨  --ã€‹å®‰è£…

#### æ–‡ä»¶ç³»ç»Ÿéƒ¨åˆ† 
å¯åŠ¨æµç¨‹ï¼š


1. å†…æ ¸åŠ è½½å®Œæˆ



2. æ‰§è¡Œmountæ“ä½œ

æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿæƒ³è¦æ“ä½œæ–‡ä»¶ç³»ç»Ÿï¼Œ

ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿ



3. è¯»å–è¶…çº§å—
4. å®šä½inode 2
5. å°†å…¶æŒ‚è½½ä¸ºæ ¹ç›®å½•

```
ç³»ç»Ÿå¯åŠ¨è¿‡ç¨‹ï¼š
+----------------+     +---------------+     +------------------+
| è¯»å–è¶…çº§å—     | --> | å®šä½inode 2   | --> | æŒ‚è½½ä¸ºæ ¹ç›®å½•(/)  |
+----------------+     +---------------+     +------------------+
```

![](https://files.mdnice.com/user/5197/19959a5e-7bf2-44c5-8bb6-7ca9f37d6349.png)


åœ¨ Linux å¯åŠ¨è¿‡ç¨‹ä¸­ï¼ŒåŠ è½½ ext4 æ–‡ä»¶ç³»ç»Ÿä¸»è¦ç»å†ä»¥ä¸‹å‡ ä¸ªé˜¶æ®µï¼š

1. **å†…æ ¸åŠ è½½ä¸åˆå§‹åŒ–**  
   - å½“ç³»ç»Ÿé€šè¿‡ BIOS/UEFI åŠ è½½å¼•å¯¼åŠ è½½ç¨‹åºï¼ˆå¦‚ GRUBï¼‰åï¼Œå†…æ ¸è¢«åŠ è½½åˆ°å†…å­˜ä¸­ã€‚  
   - å†…æ ¸åˆå§‹åŒ–æ—¶ï¼Œä¼šå»ºç«‹ VFSï¼ˆè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼‰æ ¸å¿ƒæ•°æ®ç»“æ„ï¼Œå¦‚ dentry å“ˆå¸Œè¡¨å’Œ inode å“ˆå¸Œè¡¨ï¼Œå¹¶åŠ è½½å¿…è¦çš„æ–‡ä»¶ç³»ç»Ÿé©±åŠ¨ï¼ˆext4 é©±åŠ¨å¯ä»¥æ˜¯å†…ç½®çš„æˆ–ä½œä¸ºæ¨¡å—åŠ è½½ï¼‰ã€‚

2. **æŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿ**  
   - å†…æ ¸æ ¹æ®å¯åŠ¨å‚æ•°ï¼ˆä¾‹å¦‚ root=/dev/sda1ï¼‰ç¡®å®šæ ¹æ–‡ä»¶ç³»ç»Ÿæ‰€åœ¨çš„è®¾å¤‡ã€‚  
   - è°ƒç”¨å‡½æ•°å¦‚ **vfs_kern_mount()**ï¼ˆè¿›ä¸€æ­¥è°ƒç”¨ ext4_mount()ï¼‰æ¥æŒ‚è½½ ext4 æ–‡ä»¶ç³»ç»Ÿã€‚  
   - åœ¨æŒ‚è½½è¿‡ç¨‹ä¸­ï¼Œext4 é©±åŠ¨ä¼šè¯»å–è®¾å¤‡ä¸Šçš„è¶…çº§å—ï¼ˆsuperblockï¼‰ï¼ŒéªŒè¯ ext4 çš„é­”æ•°ï¼ˆmagic numberï¼‰å’Œå…¶å®ƒå…ƒæ•°æ®ï¼ŒåŒæ—¶åˆå§‹åŒ– inode è¡¨ã€æ—¥å¿—ï¼ˆjournalï¼‰ç­‰å†…éƒ¨æ•°æ®ç»“æ„ã€‚  
   - ext4 æ–‡ä»¶ç³»ç»Ÿçš„æ ¹ç›®å½•åœ¨æŒ‚è½½æ—¶æ ¹æ®çº¦å®šæ€»æ˜¯åˆ†é… inode å· 2ã€‚

3. **åˆ‡æ¢æ ¹æ–‡ä»¶ç³»ç»Ÿï¼ˆpivot_root/switch_rootï¼‰**  
   - å¦‚æœç³»ç»Ÿä½¿ç”¨äº† initrd æˆ– initramfs ä½œä¸ºä¸´æ—¶æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œå†…æ ¸ä¼šåœ¨åŠ è½½å®ŒçœŸæ­£çš„ ext4 æ–‡ä»¶ç³»ç»Ÿåï¼Œé€šè¿‡ pivot_root æˆ– switch_root å°†æ ¹ç›®å½•åˆ‡æ¢åˆ°æŒ‚è½½çš„ ext4 æ–‡ä»¶ç³»ç»Ÿä¸Šã€‚
   - æ­¤æ—¶ï¼Œinitï¼ˆæˆ– systemdï¼‰è¿›ç¨‹å¯åŠ¨ï¼Œç”¨æˆ·ç©ºé—´æ¥ç®¡å¹¶ç»§ç»­åç»­çš„åˆå§‹åŒ–å·¥ä½œã€‚

è¿™æ ·ï¼Œæ•´ä¸ªè¿‡ç¨‹ç¡®ä¿äº† ext4 æ–‡ä»¶ç³»ç»Ÿçš„å…ƒæ•°æ®å’Œæ•°æ®å—è¢«æ­£ç¡®åŠ è½½ï¼Œå¹¶æœ€ç»ˆæˆä¸ºç³»ç»Ÿçš„æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œä½¿ç”¨æˆ·å’Œåº”ç”¨ç¨‹åºå¯ä»¥æ­£å¸¸è®¿é—®æ–‡ä»¶æ•°æ®ã€‚


#### ä½œä¸šï¼šä¸ºä»€ä¹ˆä¸åŒæŒ‚è½½ç‚¹çš„inodeå·ç éƒ½æ˜¯2
```
[root@watchpoints ~]# lsblk
NAME   MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
loop0    7:0    0   1G  0 loop /mnt/icfs
sr0     11:0    1  19M  0 rom
vda    253:0    0  50G  0 disk
â””â”€vda1 253:1    0  50G  0 part /
[root@watchpoints ~]# ls -id /
2 /
[root@watchpoints ~]# ls -id /mnt/icfs
2 /mnt/icfs

åŒç†

æˆ‘ä»¬æœ‰3ä¸ªä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿåˆ†åˆ«æŒ‚è½½åˆ°äº†3ä¸ªä¸åŒçš„æŒ‚è½½ç‚¹(ç›®å½•)ã€‚
EXT4æ ¼å¼çš„æ–‡ä»¶ç³»ç»Ÿæˆ‘ä»¬åˆ†äº†3ä¸ªï¼Œ
åˆ†åˆ«æŒ‚è½½äº†/ï¼Œ
/bootï¼Œ
/homeã€‚

é‚£ä¹ˆè¿™é‡Œçš„äº†/ï¼Œ/bootï¼Œ/homeå°±æ˜¯3ä¸ªä¸åŒçš„æŒ‚è½½ç‚¹ã€‚

```


https://github.com/torvalds/linux/blob/master/fs/ext4/ext4.h

```c
/*
 * Special inodes numbers
 */
#define	EXT4_BAD_INO		 1	/* Bad blocks inode */
#define EXT4_ROOT_INO		 2	/* Root inode */
#define EXT4_USR_QUOTA_INO	 3	/* User quota inode */
#define EXT4_GRP_QUOTA_INO	 4	/* Group quota inode */
#define EXT4_BOOT_LOADER_INO	 5	/* Boot loader inode */
#define EXT4_UNDEL_DIR_INO	 6	/* Undelete directory inode */
#define EXT4_RESIZE_INO		 7	/* Reserved group descriptors inode */
#define EXT4_JOURNAL_INO	 8	/* Journal inode */
```

## äºŒã€æé—®ï¼šLinux æ–‡ä»¶ç³»ç»Ÿæ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ


![](https://files.mdnice.com/user/5197/fbb9cc2e-e131-4b9b-96b5-d8b36b4666be.png)


é€šè¿‡è¿™å¼ å›¾ï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ VFS çš„ä¸‹æ–¹ï¼ŒLinux æ”¯æŒå„ç§å„æ ·çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå¦‚ Ext4ã€XFSã€NFS ç­‰ç­‰ã€‚æŒ‰ç…§å­˜å‚¨ä½ç½®çš„ä¸åŒï¼Œ

è¿™äº›æ–‡ä»¶ç³»ç»Ÿå¯ä»¥åˆ†ä¸ºä¸‰ç±»ã€‚

- ç±»æ˜¯åŸºäºç£ç›˜çš„æ–‡ä»¶ç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯æŠŠæ•°æ®ç›´æ¥å­˜å‚¨åœ¨è®¡ç®—æœºæœ¬åœ°æŒ‚è½½çš„ç£ç›˜ä¸­ã€‚
 è§çš„ Ext4ã€XFSã€OverlayFS ç­‰ï¼Œéƒ½æ˜¯è¿™ç±»æ–‡ä»¶ç³»ç»Ÿã€‚

- ç±»æ˜¯åŸºäºå†…å­˜çš„æ–‡ä»¶ç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿã€‚

 
 - ç±»æ˜¯ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼Œ
 
 ä¹Ÿå°±æ˜¯ç”¨æ¥è®¿é—®å…¶ä»–è®¡ç®—æœºæ•°æ®çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ¯”å¦‚ NFSã€SMBã€iSCSI ç­‰ã€‚
 
 ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿ NFSï¼šé¦–æ¬¡çªç ´å†…æ ¸æ€
 
 éšç€è®¡ç®—éœ€æ±‚çš„å¢é•¿ï¼Œå•å°è®¡ç®—æœºçš„æ€§èƒ½é€æ¸æ— æ³•æ»¡è¶³æ—¥ç›Šå¢é•¿çš„è®¡ç®—å’Œå­˜å‚¨è¦æ±‚ã€‚
 
 äººä»¬å¼€å§‹å¼•å…¥å¤šå°è®¡ç®—æœºï¼Œä»¥åˆ†æ‹…è´Ÿè½½å¹¶æé«˜æ•´ä½“æ•ˆç‡ã€‚

åœ¨è¿™ä¸€åœºæ™¯ä¸‹ï¼Œä¸€ä¸ªåº”ç”¨ç¨‹åºå¾€å¾€éœ€è¦è®¿é—®åˆ†å¸ƒåœ¨å¤šå°è®¡ç®—æœºä¸Šçš„æ•°æ®ã€‚

ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œäººä»¬æå‡ºäº†åœ¨ç½‘ç»œä¸­å¼•å…¥è™šæ‹Ÿå­˜å‚¨å±‚çš„æ¦‚å¿µï¼Œå°†è¿œç¨‹è®¡ç®—æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚æŸä¸ªç›®å½•ï¼‰é€šè¿‡ç½‘ç»œæ¥å£æŒ‚è½½åˆ°æœ¬åœ°è®¡ç®—æœºçš„èŠ‚ç‚¹ä¸Šã€‚

è¿™æ ·åšçš„ç›®çš„æ˜¯ä½¿æœ¬åœ°è®¡ç®—æœºèƒ½å¤Ÿæ— ç¼åœ°è®¿é—®è¿œç¨‹è®¡ç®—æœºçš„æ•°æ®ï¼Œå°±å¥½åƒè¿™äº›æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°ä¸€æ ·ã€‚


![](https://files.mdnice.com/user/5197/a9c943c9-78b6-441a-ad56-12c5d1d28df4.png)

![](https://files.mdnice.com/user/5197/fa006f13-edfb-4e80-94f1-183aa24b56e9.png)

linuxåˆ†æåˆ©åˆƒä¹‹sarå‘½ä»¤è¯¦è§£

å‚è€ƒï¼š
https://www.cnblogs.com/zsql/p/11628766.html
 sar -n DEV 1 1#ç»Ÿè®¡ç½‘ç»œä¿¡æ¯  è¿™ä¸ªæœ‰ç”¨å¸¦å®½ç»Ÿè®¡

æŸ¥çœ‹è¿›è¡Œå“ªäº›çº¿ç¨‹



#### æ–‡ä»¶ç³»ç»Ÿçš„æ ¼å¼
æ¥æºï¼š
https://zh.wikipedia.org/wiki/Ext4

ç¬¬å››ä»£æ‰©å±•æ–‡ä»¶ç³»ç»Ÿï¼ˆè‹±è¯­ï¼šFourth extended filesystemï¼Œç¼©å†™ä¸ºext4ï¼‰æ˜¯Linuxç³»ç»Ÿä¸‹çš„æ—¥å¿—æ–‡ä»¶ç³»ç»Ÿ


æ–‡ä»¶ç³»ç»Ÿ(å…­)ï¼šä¸€æ–‡çœ‹æ‡‚linux ext4æ–‡ä»¶ç³»ç»Ÿå·¥ä½œåŸç†

ext4å®ƒçªå‡ºçš„ç‰¹ç‚¹æœ‰ï¼šæ•°æ®åˆ†æ®µç®¡ç†ã€å¤šå—åˆ†é…ã€å»¶è¿Ÿåˆ†é…ã€æŒä¹…é¢„åˆ†é…ã€æ—¥å¿—æ ¡éªŒã€æ”¯æŒæ›´å¤§çš„æ–‡ä»¶ç³»ç»Ÿå’Œæ–‡ä»¶å¤§å°ã€‚

ext4æ–‡ä»¶ç³»ç»Ÿçš„å…·ä½“å®ç°æ¯”è¾ƒå¤æ‚ï¼Œæœ¬æ–‡å°è¯•ç”¨æ¯”è¾ƒç®€å•çš„æ–¹å¼ç”¨ä¸€ç¯‡æ–‡ç« çš„ç¯‡å¹…æ¥ç®€å•åœ°ä»‹ç»ä¸€ä¸‹å®ƒçš„å·¥ä½œåŸç†ã€‚


å‘½ä»¤ï¼šdumpe2fs /dev/loop0


![](https://files.mdnice.com/user/5197/c07c56ac-f09c-4c06-aa8b-8cffdc03de4f.png)

![](https://files.mdnice.com/user/5197/7f401eb1-0b91-4867-b6b6-d07f7eb6fe3b.png)


![](https://files.mdnice.com/user/5197/94061f23-39f7-464f-bd01-dce0d673ee66.png)


ä»ä¸Šé¢dumpe2fsçš„æ•°æ®ä¸Šæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œä¸€ä¸ª1GBå¤§å°çš„ç©ºé—´ï¼Œext4 æ–‡ä»¶ç³»ç»Ÿå°†å®ƒåˆ†éš”æˆäº†0~7çš„8ä¸ªGroupã€‚


å…¶ä¸­ï¼Œæ¯ä¸ªGroupä¸­åˆæœ‰superblockã€Group descriptorsã€bitmapã€Inode tableã€usrer dataã€è¿˜æœ‰ä¸€äº›ä¿ç•™ç©ºé—´ï¼Œç»†åˆ†ä¹‹åçš„ç©ºé—´å¸ƒå±€å¦‚ä¸‹ï¼š
ext4 çš„æ€»ä½“ç£ç›˜å¸ƒå±€å¦‚ä¸‹ï¼š



![](https://files.mdnice.com/user/5197/34cf07ac-24f6-432d-a0ac-92160e5e6067.png)


å…·ä½“å«ä¹‰å†…ï¼š
ext4æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯è¡¨

ä»ä¸Šé¢ã€Š1.1 ext4æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯è¡¨ã€‹ä¸­å¯ä»¥çŸ¥é“Primary superblockåœ¨ç¬¬0å·blockï¼Œæ¯ä¸ªblockçš„å¤§å°ä¸º4096Byte

æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯ã€å—å¤§å°å’Œå—ç»„ä¿¡æ¯ã€Inode ç›¸å…³ä¿¡æ¯ã€æ–‡ä»¶ç³»ç»Ÿå¤§å°å’Œä½¿ç”¨æƒ…å†µã€æ—¥å¿—ç›¸å…³ä¿¡æ¯ã€æŒ‚è½½ä¿¡æ¯ã€æ ¡éªŒå’Œå’Œå¤‡ä»½ä¿¡æ¯ã€‚


è¿™é‡Œé¢æˆ‘è¿˜éœ€è¦é‡ç‚¹è¯´ä¸€ä¸‹ï¼Œè¶…çº§å—å’Œå—ç»„æè¿°ç¬¦è¡¨éƒ½æ˜¯å…¨å±€ä¿¡æ¯ï¼Œè€Œä¸”è¿™äº›æ•°æ®å¾ˆé‡è¦ã€‚


å¦‚æœè¿™äº›æ•°æ®ä¸¢å¤±äº†ï¼Œæ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿéƒ½æ‰“ä¸å¼€äº†ï¼Œè¿™æ¯”ä¸€ä¸ªæ–‡ä»¶çš„ä¸€ä¸ªå—æŸåæ›´ä¸¥é‡ã€‚æ‰€ä»¥ï¼Œè¿™ä¸¤éƒ¨åˆ†æˆ‘ä»¬éƒ½éœ€è¦å¤‡ä»½ï¼Œä½†æ˜¯é‡‡å–ä¸åŒçš„ç­–ç•¥ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¶…çº§å—å’Œå—ç»„æè¿°ç¬¦è¡¨éƒ½æœ‰å‰¯æœ¬ä¿å­˜åœ¨æ¯ä¸€ä¸ªå—ç»„é‡Œé¢


å…¶å®ä½¿ç”¨dumpe2fså‘½ä»¤æŸ¥çœ‹çš„ext4æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯å°±æ˜¯ä»superblockä¸Šçš„æ•°æ®è§£æè€Œæ¥ã€‚

é™¤äº†Primary superblockï¼Œè¿˜åœ¨ä¸åŒçš„groupä¸­æœ‰å¤‡ä»½superblockï¼Œå…¶å†…å®¹ä¸Primary superblockåŸå§‹æ•°æ®ç›¸åŒï¼ŒPrimary superblockæŸåçš„æ—¶å€™å¯ä»¥ä»å¤‡ä»½åŒºæ¢å¤å›æ¥

![](https://files.mdnice.com/user/5197/e0275fef-c23a-4b7d-978d-9c32ca904527.png)



å›é¡¾ï¼š

åœ¨ Linux å†…æ ¸æŒ‚è½½ ext4 æ–‡ä»¶ç³»ç»Ÿæ—¶ï¼ŒæŒ‚è½½æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š

1. **ç³»ç»Ÿè°ƒç”¨ mount() å¯åŠ¨æŒ‚è½½æµç¨‹**  
   å½“ç”¨æˆ·æˆ–å†…æ ¸å¯åŠ¨å‚æ•°ï¼ˆå¦‚ root=/dev/sda1ï¼‰è§¦å‘æŒ‚è½½æ—¶ï¼Œä¼šè°ƒç”¨é€šç”¨çš„ mount ç³»ç»Ÿè°ƒç”¨ï¼Œè¿›è€Œè¿›å…¥ VFS å±‚çš„æŒ‚è½½æµç¨‹ã€‚

2. **è¿›å…¥ ext4 æŒ‚è½½å…¥å£ ext4_mount()**  
   ext4 æ–‡ä»¶ç³»ç»Ÿåœ¨å†…æ ¸ä¸­æ³¨å†Œä¸ºä¸€ç§æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼Œå…¶æŒ‚è½½å…¥å£å‡½æ•°é€šå¸¸ä¸º ext4_mount()ï¼ˆå®šä¹‰åœ¨ fs/ext4/super.c ä¸­ï¼‰ã€‚  
   åœ¨è¯¥å‡½æ•°ä¸­ï¼Œä¼šè°ƒç”¨ ext4_fill_super()ï¼Œç”¨æ¥è¯»å–ç£ç›˜ä¸Šçš„è¶…çº§å—ï¼ˆsuperblockï¼‰å¹¶éªŒè¯ ext4 æ–‡ä»¶ç³»ç»Ÿçš„å®Œæ•´æ€§ã€‚

3. **è§£æè¶…çº§å—ä¸åŠ è½½æ ¹ inode**  
   ext4_fill_super() ä¼šä»è®¾å¤‡ä¸Šè¯»å–è¶…çº§å—æ•°æ®ï¼Œç„¶åå¡«å……è¶…çº§å—ç»“æ„ä½“ã€‚åœ¨è¶…çº§å—ä¸­ä¿å­˜äº†æ–‡ä»¶ç³»ç»Ÿå…¨å±€ä¿¡æ¯ï¼Œå…¶ä¸­å°±åŒ…æ‹¬ ext4 æ–‡ä»¶ç³»ç»Ÿçš„æ ¹ç›®å½• inode çš„å›ºå®šç¼–å·ï¼ˆEXT4_ROOT_INO å®šä¹‰ä¸º 2ï¼Œè§ fs/ext4/ext4.hï¼‰ã€‚  
   ç´§æ¥ç€ï¼Œå†…æ ¸é€šè¿‡ ext4_iget()ï¼ˆæˆ–ç›¸å…³å‡½æ•°ï¼‰åŠ è½½ inode 2ï¼Œè¿™ä¸ª inode å°±ä»£è¡¨äº†æ–‡ä»¶ç³»ç»Ÿçš„æ ¹ç›®å½•ã€‚

4. **æ„é€ æ ¹ç›®å½• dentry å¹¶å®ŒæˆæŒ‚è½½**  
   åŠ è½½æ ¹ inode åï¼Œå†…æ ¸ä¼šåˆ›å»ºç›¸åº”çš„ dentryï¼ˆç›®å½•é¡¹ï¼‰ï¼Œå¹¶å°†è¯¥æ ¹ dentry ä½œä¸ºæŒ‚è½½ç‚¹çš„æ ¹ï¼Œæœ€ç»ˆå°†æ•´ä¸ªæ–‡ä»¶ç³»ç»ŸæŒ‚è½½ä¸ºæ ¹ç›®å½•ï¼ˆ/ï¼‰ã€‚

ç›¸å…³æºç ä¸»è¦åˆ†å¸ƒåœ¨å†…æ ¸æºä»£ç çš„ fs/ext4/ ç›®å½•ä¸‹ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹ ext4_mount()ã€ext4_fill_super() ä»¥åŠ ext4_iget() ç­‰å‡½æ•°ã€‚  




#### ext4 æ–‡ä»¶ç³»ç»Ÿç‰¹ç‚¹çš„

- å¸¦ç€é—®é¢˜å» é˜…è¯»ï¼šext4æ–‡ä»¶ç³»ç»Ÿå•ä¸ªæ–‡ä»¶å­˜å‚¨å¤§å°æ˜¯å¤šå°‘ï¼Ÿ4TB è¿˜æ˜¯16TB

![](https://files.mdnice.com/user/5197/6b247a88-b726-45be-9650-a112f9ce3ec9.png)
> Linuxçš„ext4æ–‡ä»¶ç³»ç»Ÿï¼Œä¸ºä»€ä¹ˆinodeé‡Œåªæœ‰12ä¸ªæŒ‡å‘æ•°æ®å—çš„ç›´æ¥æŒ‡é’ˆï¼Ÿ

- Ext4åªæœ‰12ä¸ªæŒ‡å‘æ•°æ®å—çš„ç›´æ¥æŒ‡é’ˆæ˜¯æ²¿ç”¨çš„Ext3çš„è®¾è®¡ï¼Œä¸ºäº†ä¿è¯å‰å‘å…¼å®¹ã€‚å¯¹äºExt4æ–‡ä»¶ç³»ç»Ÿæ¥è¯´ï¼Œ12ä¸ªç›´æ¥å—å¯ä»¥è§£å†³å¤§éƒ¨åˆ†å°æ–‡ä»¶çš„åœºæ™¯ã€‚å¦‚æœæ–‡ä»¶å¤ªå¤§ï¼Œé€šè¿‡ç›´æ¥å—çš„æ–¹å¼å…ƒæ•°æ®å°†ä¼šå ç”¨å¤ªå¤šç©ºé—´ã€‚

- EXT3 é€‚åˆä¸­å°è§„æ¨¡å­˜å‚¨ï¼Œä¸é€‚åˆè¶…å¤§æ–‡ä»¶ï¼ˆ>2TBï¼‰

```c++


ä»£ç ä½ç½®ï¼š
- https://github.com/torvalds/linux/blob/master/fs/ext4/ext4.h#L771


struct ext4_inode {
  __le32  i_block[EXT4_N_BLOCKS];/* Pointers to blocks */ n=15
};

/*
 * Constants relative to the data blocks
 */
#define	EXT4_NDIR_BLOCKS		12
#define	EXT4_IND_BLOCK			EXT4_NDIR_BLOCKS
#define	EXT4_DIND_BLOCK			(EXT4_IND_BLOCK + 1)
#define	EXT4_N_BLOCKS			(EXT4_TIND_BLOCK + 1) //14
```


å…·ä½“å¦‚ä½•ä¿å­˜çš„å‘¢ï¼Ÿ

- EXT4_N_BLOCKS æœ‰å¦‚ä¸‹çš„å®šä¹‰ï¼Œè®¡ç®—ä¸‹æ¥ä¸€å…±æœ‰ 15 é¡¹ã€‚
- åœ¨ ext2 å’Œ ext3 ä¸­ï¼Œå…¶ä¸­å‰ 12 é¡¹ç›´æ¥ä¿å­˜äº†å—çš„ä½ç½®ï¼Œä¹Ÿ
  å°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ i_block[0-11]ï¼Œç›´æ¥å¾—åˆ°ä¿å­˜æ–‡ä»¶å†…å®¹çš„å—ã€‚

- å¦‚æœä¸€ä¸ªæ–‡ä»¶æ¯”è¾ƒå¤§ï¼Œ12 å—æ”¾ä¸ä¸‹ i_block[12]æŒ‡å‘ä¸€ä¸ªå—ï¼Œè¿™ä¸ªå—é‡Œé¢ä¸æ”¾æ•°æ®å—ï¼Œè€Œæ˜¯æ”¾æ•°æ®å—çš„ä½ç½®ï¼Œ
 è¿™ä¸ªå—æˆ‘ä»¬ç§°ä¸ºé—´æ¥å—ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åœ¨ i_block[12]é‡Œé¢æ”¾é—´æ¥å—çš„ä½ç½®ï¼Œé€šè¿‡ i_block[12]æ‰¾åˆ°é—´æ¥å—åï¼Œé—´æ¥å—é‡Œé¢æ”¾æ•°æ®å—çš„ä½ç½®ï¼Œé€šè¿‡é—´æ¥å—å¯ä»¥æ‰¾åˆ°æ•°æ®å—ã€‚


- å¦‚æœæ–‡ä»¶å†å¤§ä¸€äº›ï¼Œi_block[13]ä¼šæŒ‡å‘ä¸€ä¸ªå—ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨äºŒæ¬¡é—´æ¥å—ã€æŒ‡é’ˆçš„æŒ‡é’ˆã€‘
- å¦‚æœæ–‡ä»¶å†å¤§ä¸€äº›ï¼Œi_block[14]ä¼šæŒ‡å‘ä¸‰æ¬¡é—´æ¥å—

![](https://files.mdnice.com/user/5197/8859f9aa-96ce-4c66-a651-21027837e477.png)


EXT4 æ–‡ä»¶ç³»ç»Ÿé‡‡ç”¨ **ç´¢å¼•èŠ‚ç‚¹ï¼ˆinodeï¼‰ç»“æ„** æ¥ç®¡ç†æ–‡ä»¶ï¼Œå…¶ä¸­ **inode ç»“æ„ä¸­åŒ…å« 15 ä¸ªæŒ‡é’ˆ**ï¼Œç”¨äºå®šä½æ–‡ä»¶æ•°æ®å—ã€‚  

### **EXT4 Inode ç»“æ„ä¸­çš„ 15 ä¸ªæŒ‡é’ˆ**
| æŒ‡é’ˆç±»å‹ | æ•°é‡ | è¯´æ˜ |
|---------|------|------|
| **ç›´æ¥å—æŒ‡é’ˆï¼ˆDirect Blockï¼‰** | 12 | ç›´æ¥æŒ‡å‘æ•°æ®å—ï¼Œæ¯ä¸ªæŒ‡é’ˆå¯å¯»å€ 1 ä¸ªæ•°æ®å—ã€‚ |
| **ä¸€æ¬¡é—´æ¥æŒ‡é’ˆï¼ˆSingly Indirectï¼‰** | 1 | æŒ‡å‘ä¸€ä¸ªå—ï¼Œè¯¥å—å†…å­˜å‚¨å¤šä¸ªç›´æ¥å—æŒ‡é’ˆã€‚ |
| **äºŒæ¬¡é—´æ¥æŒ‡é’ˆï¼ˆDoubly Indirectï¼‰** | 1 | æŒ‡å‘ä¸€ä¸ªå—ï¼Œè¯¥å—å†…çš„æŒ‡é’ˆæŒ‡å‘å¤šä¸ªä¸€æ¬¡é—´æ¥å—ã€‚ |
| **ä¸‰æ¬¡é—´æ¥æŒ‡é’ˆï¼ˆTriply Indirectï¼‰** | 1 | æŒ‡å‘ä¸€ä¸ªå—ï¼Œè¯¥å—å†…çš„æŒ‡é’ˆæŒ‡å‘å¤šä¸ªäºŒæ¬¡é—´æ¥å—ã€‚ |

---

### **å•ä¸ªæ–‡ä»¶æœ€å¤§æ”¯æŒå¤§å°è®¡ç®—**
å‡è®¾ **å—å¤§å°ï¼ˆblock sizeï¼‰ä¸º 4KB**ï¼ˆEXT4 å¸¸ç”¨è®¾ç½®ï¼‰ï¼Œè®¡ç®—å•ä¸ªæ–‡ä»¶æœ€å¤§å¤§å°ï¼š

1. **ç›´æ¥å—å­˜å‚¨æ•°æ®**ï¼š
   - 12 ä¸ªç›´æ¥æŒ‡é’ˆ Ã— 4KB = **48KB**

2. **ä¸€æ¬¡é—´æ¥å—å­˜å‚¨æ•°æ®**ï¼š
   - 1 ä¸ªæŒ‡é’ˆå—å­˜å‚¨ 1024 ä¸ªæŒ‡é’ˆï¼ˆ4KB / 4B = 1024ï¼‰
   - 1024 Ã— 4KB = **4MB**

3. **äºŒæ¬¡é—´æ¥å—å­˜å‚¨æ•°æ®**ï¼š
   - 1 ä¸ªæŒ‡é’ˆå—å­˜å‚¨ 1024 ä¸ªä¸€æ¬¡é—´æ¥æŒ‡é’ˆ
   - 1024 Ã— 4MB = **4GB**

4. **ä¸‰æ¬¡é—´æ¥å—å­˜å‚¨æ•°æ®**ï¼š
   - 1 ä¸ªæŒ‡é’ˆå—å­˜å‚¨ 1024 ä¸ªäºŒæ¬¡é—´æ¥æŒ‡é’ˆ
   - 1024 Ã— 4GB = **4TB**

---

### **æœ€ç»ˆè®¡ç®—ï¼ˆæœ€å¤§å•ä¸ªæ–‡ä»¶å¤§å°ï¼‰**
- **ç›´æ¥å—**ï¼š48KB  
- **ä¸€æ¬¡é—´æ¥å—**ï¼š4MB  
- **äºŒæ¬¡é—´æ¥å—**ï¼š4GB  
- **ä¸‰æ¬¡é—´æ¥å—**ï¼š4TB  
- **æ€»è®¡** â‰ˆ **4TB + 4GB + 4MB + 48KB â‰ˆ 4TB**

---

### **ç»“è®º**
- **EXT4 å•ä¸ªæ–‡ä»¶æœ€å¤§å¯è¾¾ 16TB**ï¼ˆå¦‚æœå¯ç”¨äº† **æ›´å¤§çš„ block sizeï¼Œæ¯”å¦‚ 64KB**ï¼‰ã€‚
- **åœ¨ 4KB å—å¤§å°ä¸‹ï¼Œå•ä¸ªæ–‡ä»¶æœ€å¤§ â‰ˆ 4TB**ï¼ˆç”±äºç´¢å¼•ç»“æ„é™åˆ¶ï¼‰ã€‚
- **ç›¸æ¯” EXT3ï¼ˆå•æ–‡ä»¶æœ€å¤§ 2TBï¼‰ï¼ŒEXT4 æ›´é€‚åˆå¤§æ–‡ä»¶å­˜å‚¨**ã€‚

å¦‚æœéœ€è¦å­˜å‚¨è¶…è¿‡ 4TB çš„å•ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥ï¼š
1. **ä½¿ç”¨æ›´å¤§çš„å—å¤§å°ï¼ˆå¦‚ 64KBï¼Œæœ€å¤§ 16TBï¼‰**ã€‚
2. **è€ƒè™‘ä½¿ç”¨å…¶ä»–æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚ XFSã€Btrfsã€ZFSï¼‰**ã€‚


å¯¹æ¯”ï¼š


![](https://files.mdnice.com/user/5197/ffc8e407-cf9b-4deb-a3d5-ea75bfb10930.png)



>å¸¦ç€é—®é¢˜å» é˜…è¯»ï¼šext4å¦‚ä½•å­˜å‚¨å¤§æ–‡ä»¶çš„ï¼Œé‡å¾—ä»€ä¹ˆéº»çƒ¦

>å¯¹äºå¤§æ–‡ä»¶æ¥è®²ï¼Œæˆ‘ä»¬è¦å¤šæ¬¡è¯»å–ç¡¬ç›˜æ‰èƒ½æ‰¾åˆ°ç›¸åº”çš„å—ï¼Œè¿™æ ·è®¿é—®é€Ÿåº¦å°±ä¼šæ¯”è¾ƒæ…¢ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œext4 åšäº†ä¸€å®šçš„æ”¹å˜ã€‚
å®ƒå¼•å…¥äº†ä¸€ä¸ªæ–°çš„æ¦‚å¿µï¼Œå«åš Extentsã€‚

æˆ‘ä»¬æ¥è§£é‡Šä¸€ä¸‹ Extentsã€‚

æ¯”æ–¹è¯´ï¼Œä¸€ä¸ªæ–‡ä»¶å¤§å°ä¸º 128Mï¼Œå¦‚æœä½¿ç”¨ 4k å¤§å°çš„å—è¿›è¡Œå­˜å‚¨ï¼Œéœ€è¦ 32k ä¸ªå—ã€‚

å¦‚æœæŒ‰ç…§ ext2 æˆ–è€… ext3 é‚£æ ·æ•£ç€æ”¾ï¼Œæ•°é‡å¤ªå¤§äº†ã€‚

ä½†æ˜¯ Extents å¯ä»¥ç”¨äºå­˜æ”¾è¿ç»­çš„å—ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ 128M æ”¾åœ¨ä¸€ä¸ª Extents é‡Œé¢ã€‚

è¿™æ ·çš„è¯ï¼Œå¯¹å¤§æ–‡ä»¶çš„è¯»å†™æ€§èƒ½æé«˜äº†ï¼Œæ–‡ä»¶ç¢ç‰‡ä¹Ÿå‡å°‘äº†ã€‚

![](https://files.mdnice.com/user/5197/716e46fc-c67c-4067-91fc-119a343cf696.png)

é™¤äº†æ ¹èŠ‚ç‚¹ï¼Œå…¶ä»–çš„èŠ‚ç‚¹éƒ½ä¿å­˜åœ¨ä¸€ä¸ªå—4ké‡Œé¢ï¼Œ4kæ‰£é™¤ext4_extent_headerçš„12ä¸ªbyteï¼Œå‰©ä¸‹çš„èƒ½å¤Ÿæ”¾340é¡¹ï¼Œæ¯ä¸ªextentæœ€å¤§èƒ½è¡¨ç¤º128MBçš„æ•°æ®ï¼Œ340ä¸ªextentä¼šä½¿ä½ çš„è¡¨ç¤ºçš„æ–‡ä»¶è¾¾åˆ°42.5GBã€‚


## ä¸‰ã€ext4æ–‡ä»¶ç³»ç»Ÿä¸ºä¾‹å­ cat /mnt/icfs/fileA åˆ¤æ–­æ–‡ä»¶fileAæ˜¯å¦å­˜åœ¨


âœ…å‰ç½®æ¡ä»¶ï¼š

åœ¨ Linux ä¸­ï¼Œæ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚ ext4ï¼‰é€šå¸¸åªèƒ½åœ¨å—è®¾å¤‡ï¼ˆblock deviceï¼‰ä¸Šåˆ›å»ºå’Œæ“ä½œï¼Œä¾‹å¦‚ï¼š

- ç‰©ç†ç£ç›˜ (/dev/sda, /dev/nvme0n1)

- ç£ç›˜åˆ†åŒº (/dev/sda1, /dev/nvme0n1p1)

- è™šæ‹Ÿå—è®¾å¤‡ï¼ˆå¦‚ LVM é€»è¾‘å· /dev/mapper/vg-lvï¼‰

å¦‚æœ æ²¡æœ‰é¢å¤–çš„ç£ç›˜ï¼Œä½†ä½ ä»ç„¶éœ€è¦ï¼š
ğŸ‘‰ ä½ å¯ä»¥ä½¿ç”¨ Loop è®¾å¤‡ï¼ˆ/dev/loopXï¼‰å°†æ™®é€šæ–‡ä»¶å½“ä½œå—è®¾å¤‡

ğŸ“Œ ä¾‹å­ï¼šç”¨ Loop è®¾å¤‡æ¨¡æ‹Ÿä¸€ä¸ª ext4 æ–‡ä»¶ç³»ç»Ÿ

```shell
# 1. åˆ›å»ºä¸€ä¸ª 1GB çš„æ™®é€šæ–‡ä»¶æ–‡ä»¶
dd if=/dev/zero of=/root/temp/virtual_disk.img bs=1M count=1024
//bs å—å¤§å°ä¸ºbytesä¸ªå­—èŠ‚
# 2. ç»‘å®šåˆ° Loop è®¾å¤‡ï¼ˆè®© Linux è®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ªç£ç›˜ï¼‰
losetup /dev/loop0 /root/temp/virtual_disk.img
//loop è®¾å¤‡æ˜¯ä¸€ç§ä¼ªè®¾å¤‡(pseudo-device)

ls -l /dev/loop0
brw-rw---- 1 root disk 7, 0 3æœˆ  24 11:25 /dev/loop0

è¦ä» ls -l çš„ç»“æœçš„ç¬¬ä¸€ä½æ ‡è¯†ä½çœ‹å‡ºæ¥ã€‚
- è¡¨ç¤ºæ™®é€šæ–‡ä»¶ï¼›
d è¡¨ç¤ºæ–‡ä»¶å¤¹ï¼›
c è¡¨ç¤ºå­—ç¬¦è®¾å¤‡æ–‡ä»¶ï¼Œ
b è¡¨ç¤ºå—è®¾å¤‡æ–‡ä»¶ï¼Œ
s è¡¨ç¤ºå¥—æ¥å­— socket æ–‡ä»¶ï¼Œ
l è¡¨ç¤ºç¬¦å·é“¾æ¥

# 3. åœ¨ /dev/loop0 ä¸Šåˆ›å»º ext4 æ–‡ä»¶ç³»ç»Ÿ
mkfs.ext4 /dev/loop0
//mkfs.ext4å‘½ä»¤æ¥è‡ªè‹±æ–‡è¯ç»„make filesystem Ext4çš„ç¼©å†™ï¼Œå…¶åŠŸèƒ½æ˜¯å¯¹ç£ç›˜è®¾å¤‡è¿›è¡ŒEXT4æ ¼å¼åŒ–æ“ä½œã€‚

åˆ›å»ºå«æœ‰ 262144 ä¸ªå—ï¼ˆæ¯å— 4kï¼‰å’Œ 65536 ä¸ªinodeçš„æ–‡ä»¶ç³»ç»Ÿ



# 4. æŒ‚è½½åˆ° /mnt ç›®å½•
mkdir /mnt/icfs
mount /dev/loop0 /mnt/icfs
//mount - mount a filesystem
# 5. æ£€æŸ¥æŒ‚è½½æƒ…å†µ
df -h | grep mydisk
ls /mnt/mydisk

```



# æé—® cat /mnt/icfs/file æŸ¥æ‰¾è¿‡ç¨‹æ˜¯ä»€ä¹ˆ

![](https://files.mdnice.com/user/5197/a6d61712-9f04-467a-8ee4-37e7bac4a0c6.jpg)

å‡†å¤‡ï¼š

strace ä½œä¸ºä¸€ç§åŠ¨æ€è·Ÿè¸ªå·¥å…·ï¼Œstrace åº•å±‚ä½¿ç”¨å†…æ ¸çš„ ptrace ç‰¹æ€§æ¥å®ç°å…¶åŠŸèƒ½

ï¼Œptraceå¯ä»¥è®©ä¸€ä¸ªè¿›ç¨‹ç›‘è§†å’Œæ§åˆ¶å¦ä¸€ä¸ªè¿›ç¨‹çš„æ‰§è¡Œ,å¹¶ä¸”ä¿®æ”¹è¢«ç›‘è§†è¿›ç¨‹çš„å†…å­˜ã€å¯„å™¨ç­‰,ä¸»è¦åº”ç”¨äºæ–­ç‚¹è°ƒè¯•å’Œç³»ç»Ÿè°ƒç”¨è·Ÿè¸ªï¼Œstraceå’Œgdbå·¥å…·å°±æ˜¯åŸºäºptraceç¼–å†™çš„


![](https://files.mdnice.com/user/5197/6a8c4d1e-a595-427a-b875-1b6254029fad.png)



Open ç³»ç»Ÿè°ƒç”¨è¯´èµ·


![](https://files.mdnice.com/user/5197/6ef7cdf2-0aa3-4cf7-942d-044dc5c3fdbc.jpg)

è¿™å¼ å›¾ååˆ†é‡è¦ï¼Œä¸€å®šè¦æŒæ¡ã€‚å› ä¸ºæˆ‘ä»¬åé¢çš„å­—ç¬¦è®¾å¤‡ã€å—è®¾å¤‡ã€ç®¡é“ã€è¿›ç¨‹é—´é€šä¿¡ã€ç½‘ç»œç­‰ç­‰ï¼Œå…¨éƒ¨éƒ½è¦ç”¨åˆ°è¿™é‡Œé¢çš„çŸ¥è¯†ã€‚
å¸Œæœ›å½“ä½ å†æ¬¡é‡åˆ°å®ƒçš„æ—¶å€™ï¼Œèƒ½å¤Ÿé©¬ä¸Šè¯´å‡ºå„ä¸ªæ•°æ®ç»“æ„ä¹‹é—´çš„å…³ç³»





# ä»mountåˆ°fuseå®¢æˆ·ç«¯


## 1. FUSE æ˜¯ä»€ä¹ˆï¼Ÿ

Linuxå†…æ ¸å®˜æ–¹æ–‡æ¡£å¯¹ FUSE çš„è§£é‡Šå¦‚ä¸‹ï¼š

What is FUSE?
FUSE is a userspace filesystem framework. 
It consists of a kernel module (fuse.ko), 
a userspace library (libfuse.*)
and a mount utility (fusermount).

æ€è€ƒé—®é¢˜ï¼šå†…æ ¸çš„ fuse.ko æ¨¡å—ï¼Œè¿˜æœ‰ libfuse åº“ã€‚è¿™ä¸¤ä¸ªè§’è‰²æ˜¯çš„ä½œç”¨ï¼Ÿ

è¿™ä¸¤ä¸ªæ¨¡å—ä¸€ä¸ªä½äºå†…æ ¸ï¼Œä¸€ä¸ªä½äºç”¨æˆ·æ€ï¼Œæ˜¯é…å¥—ä½¿ç”¨çš„ï¼Œæœ€æ ¸å¿ƒçš„åŠŸèƒ½æ˜¯åè®®å°è£…å’Œè§£æã€‚

ä¸¾ç»™ä¾‹å­ï¼Œå†…æ ¸ fuse.ko ç”¨äºæ‰¿æ¥ vfs ä¸‹æ¥çš„ io è¯·æ±‚ï¼Œç„¶åå°è£…æˆ FUSE æ•°æ®åŒ…ï¼Œè½¬å‘ç»™ç”¨æˆ·æ€ã€‚

è¿™ä¸ªæ—¶å€™ï¼Œç”¨æˆ·æ€æ–‡ä»¶ç³»ç»Ÿæ”¶åˆ°è¿™ä¸ª FUSE æ•°æ®åŒ…ï¼Œå®ƒå¦‚æœæƒ³è¦çœ‹æ‡‚è¿™ä¸ªæ•°æ®åŒ…ï¼Œå°±å¿…é¡»å®ç°ä¸€å¥— FUSE åè®®çš„ä»£ç ï¼Œè¿™å¥—ä»£ç æ˜¯å…¬å¼€é€æ˜çš„ï¼Œå±äº FUSE æ¡†æ¶çš„å…¬å…±çš„ä»£ç 

ï¼Œè¿™ç§ä»£ç ä¸èƒ½å¤Ÿè®©æ‰€æœ‰çš„ç”¨æˆ·æ–‡ä»¶ç³»ç»Ÿéƒ½é‡å¤å®ç°ä¸€éï¼Œäºæ˜¯ libfuse ç”¨æˆ·åº“å°±è¯ç”Ÿäº†ã€‚

åˆ’é‡ç‚¹ï¼šFUSE æ˜¯ä¸€ä¸ªç”¨æ¥å®ç°ç”¨æˆ·æ€æ–‡ä»¶ç³»ç»Ÿçš„æ¡†æ¶

ç”¨æˆ·æ€æ–‡ä»¶ç³»ç»Ÿæ˜¯åŒºåˆ«äºå†…æ ¸æ–‡ä»¶ç³»ç»Ÿçš„ï¼Œåœ¨ç”¨æˆ·æ€æ–‡ä»¶ç³»ç»Ÿæ²¡æœ‰å‡ºç°ä¹‹å‰ï¼Œ
å¸¸è§çš„æ–‡ä»¶ç³»ç»Ÿå¦‚Ext2ã€Ext4ç­‰éƒ½æ˜¯åœ¨å†…æ ¸ä¸­ç›´æ¥å®ç°çš„ã€‚


![](https://files.mdnice.com/user/5197/66b3bd0e-c3aa-4d2c-8355-2845c87e5438.png)
é€šè¿‡è¿™å¼ å›¾ï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ VFS çš„ä¸‹æ–¹ï¼ŒLinux æ”¯æŒå„ç§å„æ ·çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå¦‚ Ext4ã€XFSã€NFS ç­‰ç­‰ã€‚æŒ‰ç…§å­˜å‚¨ä½ç½®çš„ä¸åŒï¼Œ

è¿™äº›æ–‡ä»¶ç³»ç»Ÿå¯ä»¥åˆ†ä¸ºä¸‰ç±»ã€‚

- ç±»æ˜¯åŸºäºç£ç›˜çš„æ–‡ä»¶ç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯æŠŠæ•°æ®ç›´æ¥å­˜å‚¨åœ¨è®¡ç®—æœºæœ¬åœ°æŒ‚è½½çš„ç£ç›˜ä¸­ã€‚
 è§çš„ Ext4ã€XFSã€OverlayFS ç­‰ï¼Œéƒ½æ˜¯è¿™ç±»æ–‡ä»¶ç³»ç»Ÿã€‚


- ç±»æ˜¯åŸºäºå†…å­˜çš„æ–‡ä»¶ç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿã€‚
 ç±»æ–‡ä»¶ç³»ç»Ÿï¼Œä¸éœ€è¦ä»»ä½•ç£ç›˜åˆ†é…å­˜å‚¨ç©ºé—´ï¼Œä½†ä¼šå ç”¨å†…å­˜ã€‚æˆ‘ä»¬ç»å¸¸ç”¨åˆ°çš„ /proc æ–‡ä»¶ç³»ç»Ÿ
 
 - ç±»æ˜¯ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼Œ
 
 ä¹Ÿå°±æ˜¯ç”¨æ¥è®¿é—®å…¶ä»–è®¡ç®—æœºæ•°æ®çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ¯”å¦‚ NFSã€SMBã€iSCSI ç­‰ã€‚




## 2. FUSE åŸç†æ˜¯ä»€ä¹ˆ

ä»£ç ï¼š
https://github.com/libfuse/libfuse/blob/master/example/hello.c

![](https://files.mdnice.com/user/5197/5f0ee6c7-ccb5-4ac3-ac01-1f503535d0f4.png)

![](https://files.mdnice.com/user/5197/7a5d505b-3b65-475d-b4ef-a8f1ef0a4cb8.png)

![](https://files.mdnice.com/user/5197/4b730f9d-ae88-4267-a03d-dcbf6a2126f2.png)

è¿™ä¸ªå›¾çš„æ„æ€æ˜¯ï¼š

èƒŒæ™¯ï¼šä¸€ä¸ªç”¨æˆ·æ€æ–‡ä»¶ç³»ç»Ÿï¼ŒæŒ‚è½½ç‚¹ä¸º /tmp/fuse ï¼Œç”¨æˆ·äºŒè¿›åˆ¶ç¨‹åºæ–‡ä»¶ä¸º ./hello ï¼›

å½“æ‰§è¡Œ ls -l /tmp/fuse å‘½ä»¤çš„æ—¶å€™ï¼Œ

æµç¨‹å¦‚ä¸‹ï¼š
IO è¯·æ±‚å…ˆè¿›å†…æ ¸ï¼Œç» vfs ä¼ é€’ç»™å†…æ ¸ FUSE æ–‡ä»¶ç³»ç»Ÿæ¨¡å—ï¼›

å†…æ ¸ FUSE æ¨¡å—æŠŠè¯·æ±‚å‘ç»™åˆ°ç”¨æˆ·æ€ï¼Œç”± ./hello ç¨‹åºæ¥æ”¶å¹¶ä¸”å¤„ç†ã€‚

å¤„ç†å®Œæˆä¹‹åï¼Œå“åº”åŸè·¯è¿”å›ï¼›


åˆ’é‡ç‚¹ï¼š

å®ç°äº† FUSE çš„ç”¨æˆ·æ€æ–‡ä»¶ç³»ç»Ÿæœ‰éå¸¸å¤šçš„ä¾‹å­ï¼Œæ¯”å¦‚ï¼ŒGlusterFSï¼ŒSSHFSï¼ŒCephFSï¼ŒLustreï¼ŒGmailFSï¼ŒEncFSï¼ŒS3FS


### åº”ç”¨ï¼šJuiceFS ï¼šFUSE ç”¨æˆ·æ€åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ

æ”¶ç›Šï¼š

FUSE é€šè¿‡å°†ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´è§£è€¦ï¼Œä¸ºå¼€å‘è€…æä¾›äº†åœ¨ç”¨æˆ·ç©ºé—´å®ç°æ–‡ä»¶ç³»ç»Ÿçš„å·¨å¤§çµæ´»æ€§å’Œä¾¿åˆ©æ€§ã€‚

ç‰¹åˆ«æ˜¯åœ¨äº‘è®¡ç®—å’Œåˆ†å¸ƒå¼å­˜å‚¨ç­‰ç°ä»£è®¡ç®—ç¯å¢ƒä¸­ï¼ŒFUSE ä½¿å¾—æ„å»ºå’Œç»´æŠ¤å¤æ‚çš„å­˜å‚¨ç³»ç»Ÿå˜å¾—æ›´åŠ é«˜æ•ˆã€å¯å®šåˆ¶å’Œæ˜“äºæ‰©å±•ã€‚


![](https://files.mdnice.com/user/5197/8ec2aabf-968e-44a2-8954-d3d1c7d42c07.png)



ä»¥ç”¨æˆ·æŒ‚è½½ JuiceFS åï¼Œopen å…¶ä¸­ä¸€ä¸ªæ–‡ä»¶çš„æµç¨‹ä¸ºä¾‹ã€‚

è¯·æ±‚é¦–å…ˆé€šè¿‡å†…æ ¸ VFSï¼Œç„¶åä¼ é€’ç»™å†…æ ¸çš„ FUSE æ¨¡å—ï¼Œç»è¿‡ /dev/fuse è®¾å¤‡ä¸ JuiceFS çš„å®¢æˆ·ç«¯è¿›ç¨‹é€šä¿¡ã€‚



å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š

å½“ JuiceFS mount åï¼ŒJuiceFS å†…éƒ¨çš„ go-fuse æ¨¡å—ä¼š open /dev/fuse è·å– mount fdï¼Œå¹¶å¯åŠ¨å‡ ä¸ªçº¿ç¨‹è¯»å–å†…æ ¸çš„ FUSE è¯·æ±‚;

å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š
1. JuiceFS mount åï¼ŒJuiceFS å†…éƒ¨çš„ go-fuse æ¨¡å—ä¼š open /dev/fuse è·å– mount fdï¼Œå¹¶å¯åŠ¨å‡ ä¸ªçº¿ç¨‹è¯»å–å†…æ ¸çš„ FUSE è¯·æ±‚;
2. ç”¨ open å‡½æ•°ï¼Œé€šè¿‡ C åº“å’Œç³»ç»Ÿè°ƒç”¨è¿›å…¥ VFS å±‚ï¼ŒVFS å±‚å†å°†è¯·æ±‚è½¬ç»™å†…æ ¸çš„ FUSE æ¨¡å—ï¼›
3. FUSE æ¨¡å—æ ¹æ®åè®®å°† open è¯·æ±‚æ”¾å…¥ JuiceFS mount çš„ fd å¯¹åº”çš„é˜Ÿåˆ—ä¸­ï¼Œå¹¶å”¤é†’ go-fuse çš„è¯»è¯·æ±‚çº¿ç¨‹ï¼Œç­‰å¾…å¤„ç†ç»“æœï¼›
4. çš„ go-fuse æ¨¡å—è¯»å– FUSE è¯·æ±‚å¹¶åœ¨è§£æè¯·æ±‚åè°ƒç”¨ JuiceFS çš„å¯¹åº”å®ç°ï¼›
5. fuse å°†æœ¬æ¬¡è¯·æ±‚çš„å¤„ç†ç»“æœå†™å…¥ mount fdï¼Œå³æ”¾å…¥ FUSE ç»“æœé˜Ÿåˆ—ï¼Œç„¶åå”¤é†’ä¸šåŠ¡ç­‰å¾…çº¿ç¨‹ï¼›
6. ç¨‹è¢«å”¤é†’ï¼Œå¾—åˆ°æœ¬æ¬¡è¯·æ±‚çš„å¤„ç†ç»“æœï¼Œç„¶åå†è¿”å›åˆ°ä¸Šå±‚ã€‚

## åº”ç”¨ï¼š å°† Ceph æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ä¸º FUSE å®¢æˆ·ç«¯



å‚è€ƒä»£ç ï¼š
src\ceph_fuse.cc


åŸºæœ¬ç”¨æ³•ï¼š


![](https://files.mdnice.com/user/5197/d463bcec-c11e-4575-ae58-93fd192e6576.png)


![](https://files.mdnice.com/user/5197/c490b41a-99fd-43c8-8e3f-ec1ea40b9391.png)


- ç”¨æˆ·å¯ä»¥ç”¨ Ceph æä¾›çš„ ceph-fuse æŒ‚è½½ CephFS è¿›è¡Œè®¿é—®


ceph-fuseå¤„ç†IOæµç¨‹

ä¸¾ä¸ªä¾‹å­ lookup /fuseï¼Œä»lookup /fuseåˆ°ceph-fuseçš„æµç¨‹å›¾å¦‚ä¸‹



![](https://files.mdnice.com/user/5197/092aa4df-4505-473d-87e5-f080edc0cd67.png)

MDSè¿”å›ç»“æœç»™ceph-fuseè¿›ç¨‹ã€‚ä»ceph-fuseåˆ°lookup /fuseçš„æµç¨‹å›¾å¦‚ä¸‹
![](https://files.mdnice.com/user/5197/d0d58e74-e600-4f90-b210-d88da39b24d9.png)


```cpp
const static struct fuse_lowlevel_ops fuse_ll_oper = {
 init: do_init,
 destroy: 0,
 lookup: fuse_ll_lookup,
 forget: fuse_ll_forget,
 getattr: fuse_ll_getattr,
 setattr: fuse_ll_setattr,
 readlink: fuse_ll_readlink,
 mknod: fuse_ll_mknod,
 mkdir: fuse_ll_mkdir,
 unlink: fuse_ll_unlink,
 rmdir: fuse_ll_rmdir,
 symlink: fuse_ll_symlink,
 rename: fuse_ll_rename,
 link: fuse_ll_link,
 open: fuse_ll_open,
 read: fuse_ll_read,
 write: fuse_ll_write,
 flush: fuse_ll_flush,
 release: fuse_ll_release,
 fsync: fuse_ll_fsync,
 opendir: fuse_ll_opendir,
 readdir: fuse_ll_readdir,
 releasedir: fuse_ll_releasedir,
 fsyncdir: fuse_ll_fsyncdir,
 statfs: fuse_ll_statfs,
 setxattr: fuse_ll_setxattr,

};

```


cephfsï¼šç”¨æˆ·æ€å®¢æˆ·ç«¯write

ä»fuseåˆ°cephfså®¢æˆ·ç«¯çš„å‡½æ•°æµç¨‹å¦‚ä¸‹

![](https://files.mdnice.com/user/5197/93b6c341-6830-4800-b318-1d5ca4f720e1.png)

- ä¾‹å­ mkdir /mnt/ceph-fuse/test

mkdirå°±æ˜¯åˆ›å»ºç›®å½•ï¼Œå®¢æˆ·ç«¯å¹¶ä¸ç›´æ¥åˆ›å»ºç›®å½•ï¼Œè€Œæ˜¯å°†mkdirçš„è¯·æ±‚ï¼ˆopä¸ºCEPH_MDS_OP_MKDIRï¼‰å‘ç»™MDSï¼Œç„¶åMDSæ‰§è¡Œmkdirçš„æ“ä½œï¼Œå¹¶è¿”å›åˆ›å»ºçš„ç›®å½•çš„å…ƒæ•°æ®ã€‚

å®¢æˆ·ç«¯æ— éå°±æ˜¯å‘é€è¯·æ±‚å’Œå¤„ç†å›å¤ã€‚

![](https://files.mdnice.com/user/5197/71ba2ae4-b1da-45a7-9424-d9b968adbbee.png)

cephfsï¼šç”¨æˆ·æ€å®¢æˆ·ç«¯getattrï¼ˆ1ï¼‰

ä»libfuseåˆ°cephfsç”¨æˆ·æ€å®¢æˆ·ç«¯çš„è¿‡ç¨‹
![](https://files.mdnice.com/user/5197/f30ded85-ee8f-49c6-9df3-2be393da0765.png)

cephfsç”¨æˆ·æ€å®¢æˆ·ç«¯æ˜¯ä»fuse_ll_getattrå¼€å§‹ï¼Œfuse_ll_getattrçš„ä½œç”¨æ˜¯é€šè¿‡cfuse->client->ll_getattrè·å–inodeï¼Œå¡«å……struct statä¿¡æ¯ï¼Œå¹¶è¿”å›è¯¥statä¿¡æ¯ã€‚

![](https://files.mdnice.com/user/5197/df48c1da-843f-4776-a009-589f2c22df64.png)

cephfsï¼šç”¨æˆ·æ€å®¢æˆ·ç«¯getattrï¼ˆ2ï¼‰

å®¢æˆ·ç«¯è·å¾—çš„inodeæ¥è‡ªäºMDSï¼ˆå…ƒæ•°æ®æœåŠ¡å™¨ï¼‰ï¼Œæ‰€ä»¥å½“å®¢æˆ·ç«¯ç¼“å­˜çš„æŸä¸ªinodeéœ€è¦æ›´æ–°æ—¶ï¼Œä¼šå‘MDSå‘é€opä¸ºCEPH_MDS_OP_GETATTRçš„è¯·æ±‚ã€‚MDSå›å¤çš„æ¶ˆæ¯ä¸­å¸¦æœ‰æœ€æ–°çš„inodeæ•°æ®ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå°±å¾—äº†è§£å‘è¯·æ±‚å’Œå¤„ç†è¯·æ±‚çš„æµç¨‹ã€‚


![](https://files.mdnice.com/user/5197/d2a2413b-5534-42ea-90bf-01fbd7c55dc1.png)


åˆ’é‡ç‚¹ï¼š
- å°† Ceph æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ä¸ºå†…æ ¸å®¢æˆ·ç«¯ è¿™é‡Œä¸è®¨è®º 


# æé—®ï¼šs3fs-fuse


![](https://files.mdnice.com/user/5197/1f8001d8-4526-4b05-a9e2-c3f2647253fb.png)

s3fs-fuse æ˜¯ä¸€ä¸ªåŸºäº FUSEï¼ˆFilesystem in Userspaceï¼‰çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå…è®¸ Linuxã€macOS å’Œ FreeBSD ç³»ç»Ÿé€šè¿‡ FUSE æŒ‚è½½ Amazon S3 å­˜å‚¨æ¡¶ã€‚

é€šè¿‡ s3fs-fuseï¼Œç”¨æˆ·å¯ä»¥åƒæ“ä½œæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸€æ ·æ“ä½œ S3 å­˜å‚¨æ¡¶ä¸­çš„æ–‡ä»¶å’Œç›®å½•ã€‚è¯¥é¡¹ç›®çš„ä¸»è¦ç¼–ç¨‹è¯­è¨€æ˜¯ C++ã€‚


ä¸ºä»€ä¹ˆä½¿ç”¨fuse --å°å›¢é˜Ÿå¼€å‘ ç®€å•ä¸ºä¸» 


![](https://files.mdnice.com/user/5197/b0079726-1c01-40b3-a437-089de50026c0.png)




## å‚è€ƒã€æƒ³è¦ç”µå­ä¹¦å¯ä»¥ç§ä¿¡ã€‘

- ã€1ã€‘ Linux æ€§èƒ½ä¼˜åŒ–å®æˆ˜-- IOç« èŠ‚


![](https://files.mdnice.com/user/5197/356a4bf3-9b8f-4308-bb0a-f508f4910c62.png)

- ã€2ã€‘è¶£è°ˆ Linux æ“ä½œç³»ç»Ÿ æ ¸å¿ƒåŸç†ç¯‡ï¼šç¬¬äº”éƒ¨åˆ† æ–‡ä»¶ç³»ç»Ÿ (4è®²)

![](https://files.mdnice.com/user/5197/325d15f8-994b-47b3-8aa9-7b07cff208f7.png)


- [3] é¸Ÿå“¥çš„Linuxç§æˆ¿èœ åŸºç¡€å­¦ä¹ ç¯‡ ç¬¬å››ç‰ˆ

![](https://files.mdnice.com/user/5197/ad54163e-1235-49cc-ad3c-432170ef657d.png)

- ã€4ã€‘

 https://www.kernel.org/doc/html/latest/filesystems/fuse.html


- ã€5ã€‘å…¬å…±å· å¥‡ä¼¢
https://www.qiyacloud.cn/

https://www.cnblogs.com/liwen01/p/18237062

- [6] JuiceFS æ˜¯ä¸€æ¬¾é¢å‘äº‘åŸç”Ÿè®¾è®¡çš„é«˜æ€§èƒ½åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ
https://juicefs.com/zh-cn/blog/engineering/fuse-file-system-design

https://juicefs.com/zh-cn/blog/engineering/deepseek-3fs-vs-juicefs

-[7] ceph
- https://docs.ceph.com/en/quincy/radosgw/nfs/

- DeepSeek 3FS æºç è§£è¯»â€”â€”å®¢æˆ·ç«¯ç¯‡


- [8] 3FS
https://www.high-flyer.cn/blog/3fs-2/

https://zhuanlan.zhihu.com/p/27742193940


DeepSeek 3FS æºç è§£è¯»â€”â€”åç¨‹&RDMAç¯‡

DeepSeek 3FS æºç è§£è¯»â€”â€”ç£ç›˜ IO ç¯‡

## æ€»ç»“ 

-  æ–‡ä»¶ç³»ç»Ÿçš„æ ¹ç›®å½•çš„indoeå·æ˜¯å¤šå°‘ï¼Ÿä¸ºä»€ä¹ˆ
- æ–‡ä»¶ç³»ç»Ÿå•ä¸ªæ–‡ä»¶æœ€å¤§å­˜å‚¨æ–‡ä»¶æ•°é‡ï¼Ÿä¸ºä»€ä¹ˆ
- å¤§æ–‡ä»¶å¦‚ä½•å®ç°é«˜æ•ˆæŸ¥è¯¢ï¼Œé‡‡ç”¨æ•°æ®æ•°æ®ç»“æ„ï¼Ÿ

