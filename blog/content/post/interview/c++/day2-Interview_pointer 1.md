---
title: 面试必备之深入理解thread local
date: 2024-08-07
description: do book
draft: false
tags: 
categories:
  - do book
---
对标：https://mp.weixin.qq.com/s/qIYXDoIqILMJlRewHDkeaA
https://mp.weixin.qq.com/s/qIYXDoIqILMJlRewHDkeaA


点击<font color="#245bdb">蓝色</font>关注。

><font color="#c0504d">文末有福利，先到先得</font>







阅读本文你将获得以下收益：

知识地图：深入理解计算机系统---文件子系统

本文专注大厂面试拆解 第xxx 片文字，希望对你有帮助



# 一、 问题描述

## 


- **技术修复**
    

- 工程师在10分钟内定位问题，并`启用“红按钮”（Red Button）关闭故障代码路径`。
    
- 但由于部分大型区域（如us-central-1）的`底层基础设施（Spanner表）过载`，恢复过程耗时约2小时40分钟。
    

- **公开致歉与改进承诺**
    

- **架构调整**：增强`系统冗余设计`，避免单一故障点引发全局崩溃。
    
- **功能标志（Feature Flags）**：未来`新功能将通过灰度发布逐步上线，降低风险`。
    
- **自动化与人工通信机制**：提升故障响应效率，确保客户能及时获取信息。
    

- 谷歌云CEO托马斯·库里安通过X平台公开致歉，承认事故源于“多层级的缺陷更新”。

业务部门 / 产品线 存储产品线 产品型号 / 版本 3.7.50.28
问题来源 中移电商（湖南）项目 问题级别 严重
问题发生日期 2022 年 9 月 28 日 问题回溯日期 2023 年 3 月 8 日
根因定位时间 2022 年 12 月 10 日 回溯审核人 张凯总
质量回溯参与人 陶桐桐、蔡骞、李楠
问题描述
2022 年 9 月 27 日 22 点 45 分 至 2022 年 9 月 28 日 1 点 36 分，湖南移动现场集群进行跨 OS 升级，
从 3.7.16.20.hnyd 版本升级到 3.7.50.28 版本。凌晨 3 点 19 分客户反馈 face-file 桶的桶策略丢失，导
致用户无法访问。
问题如何恢复
1 、 3 点 19 分以后，为 face-file 桶配置桶策略，恢复现场业务。
2 、实验室复现测试，定位根因，后在 UV4 测试中复现，解决后对现场进行升级。
问题造成的影响 现场升级完成后，桶策略丢失的问题造成了用户短时间内无法访问该桶
工作流第一现场人员名单
问题模块 设计人员 编码人员 测试人员 维护人员 实施人员


# 根本原因分析
## 过程回放

## 01  事件时间线：从代码缺陷到全球崩溃背景


2025-05-29 · 新增配额策略功能（未充分测试）  
2025-06-12 10:45 · 工程师插入含空白字段策略  
2025-06-12 10:51 · 空指针触发Service Control崩溃  
2025-06-12 11:01 · SRE定位问题（10分钟响应）  
2025-06-12 13:30 · 部分区域恢复（大型区域仍过载）  
2025-06-12 18:18 · 全球服务完全恢复  
### why 技术（物理）根本原因分析


为什么个别桶策略
会丢失
1- 因为现场集群从
3.7.16.20.hnyd 版本
升级到 3.7.50.28 版本
。
2- 为什么升级会导致个
别桶策略丢失
2- 因为升级前个别桶开启
了桶配额，升级后
3.7.50.28 版本增加了默认
软配额功能。
4- 为什么自动生成默认
软配额时桶策略会丢失
4- 升级后，触发自动生成
软配额的情况下，在设置默
认软配额时，调用设置接口
用 null 覆盖了原有桶的
attrs
5- 为什么会用
null 覆盖原有的
attrs
5- 在调用接口时，
对参数的使用缺少考
究，没有对桶的
attrs 进行先读


### 测试 - 事理、人理根因分析

### 技术根因及预防措施


技术根因及预防措施

. 物理根因 改善措施 责任人 预计完成时间 最新进展
1
在软配额设计时关于与其他特
性耦合的考虑不足，代码实现
方案有欠缺。
加强特性设计时与其他特性的耦合考虑，在代码方案实现时增加对方案的讨论。制
定相关特性耦合的 checklist ，在方案确定阶段严格执行 checklist
陶桐桐 2023-3-31
2
接口规范的落实有遗漏；接口
设计的精细度不够；接口的封
装度不够
将接口分类划分组员梳理后，在内部依次主讲培训组内对齐，形成对继承代码接口
的文档、规范、模块间交互说明等，把接口的问题实现可控
陶桐桐 2023-3-31
3 研发自测覆盖面不足 特性开发完成后，补充各项配置开关打开的升级自测试用例。 陶桐桐 持续
NO 事理根因 改善措施 责任人 预计完成时间 最新进展
1 缺少升级前配置要求表 建立升级前配置要求表，明确升级前各项配置要求，确保客户升级场景在需求中全
面覆盖。 李楠 2023-3-24
NO 人理根因 改善措施 责任人 预计完成时间 最新进展
1 升级场景测试考虑不全 升级用例完善。补充各项配置在同一个桶和不在同一个桶两种场景，后续升级后需
检查两遍 李楠 2023-3-24 已完成
2 写代码以及代码 review 的同事
对代码接口调用缺陷未能识别
代码多人 review ，如果代码量超过 100 行时，需要进行会议 review ，并严格执
行 review 加分制度，并在代码合入前严格按照持续集成要求，严格执行
checklist ，给出明确研发自测报告。
陶桐桐 2022-11-30 已完成

事故不可怕，可怕时候给领导解释，给客户解释 最难受，事故表面无法改变，怎没解决的，具体代码，什么原因导致 全部虚假的。还让发现不其中错误，公司大部分测试，现场人员等贡献大于开发
### 2.2 王者归来（5-10年）

#### 一、这个技术出现的背景、初衷和要达到什么样的目标或是要解决什么样的问题







####  二、 这个技术适用的场景。任何技术都有其适用的场景




#### 三、技术的组成部分和关键点




### 五、对比java怎么实现的？



## 最动人的作品，为自己而写，刚刚好打动别人

  

我在寻找一位积极上进的小伙伴，

一起参与**神奇早起 30 天改变人生计划**，发展个人事业，不妨 试试

  

 1️⃣关注公众号:后端开发成长指南(回复面经获取）获取过去我**全部面试录音**和大厂面试复盘攻略

![](https://s2.loli.net/2025/05/31/GRgOTiQHI456VWD.png)

2️⃣ **感兴趣的读者可以通过公众号获取老王的联系方式。**

  

 加入我的技术交流群Offer 来碗里 (回复“面经”获取），一起抱团取暖

![](https://s2.loli.net/2025/06/01/6qkOut3xrDHen8J.png)

----------------我是黄金分割线-----------------------------





#### 抬头看天：走暗路、耕瘦田、进窄门、见微光，
- <font color="#ff0000">我要通过技术拿到百万年薪P7职务</font>，别人投入时间完成任务，别人采取措施解决问题了，不要不贪别人功劳，
- 但是不要给自己这样假设：别人完成就等着自己完成了，大家一个集团，一个公司，分工不同，不，这个懒惰表现，这个逃避问题表现， 
- 别人不这么假设，至少kpi上不会写成自己的，至少晋升不是你，裁员淘汰是，你的整个公司ceo，整个部门总裁，整个领导不帮助一下的，他们不这么想 ，你什么没做，战略是别人10年一点带你研究的多难，项目拆分别人10年完成多少问题，项目实现10年安排组织一点点完成多少bug，多少代码，是不要给自己这样假设：你等了看了观察10年什么做 ，0 贡献，
-  但是不要给自己这样假设，别人全部市场，别人全部市场，别人占据全部客户，一切重要无比，你太差，太才，思考不行，沟通不行，认知不行，去tmd，给别人丢脸。这个方面我无法控制，在这方面经历任何问题应该的。
- 我控制 的事情是 我必须亲自了解行业遇到难题，了解有什么需求，行业解决方案，我可以从三万英尺看问题，像周围人学习，像免费公开英文资料学习，从模仿开始。然后免费公开。我要通过技术拿到百万年薪P7职务，我必须糊涂混沌中走出来
-  目标：拿百万年 想进入一线大厂，但在C++学习和应用上存在瓶颈，渴望跨越最后一道坎。
- 现状：缺乏实战，渴望提升动手能力公司的项目不会重构，没有重新设计的机会，导致难以深入理解需求。
- 成为优秀完成任务，成为团队、公司都认可的核心骨干。优秀地完成任务= 高效能 + 高质量 + 可持续 + 可度量

##### 低头走路：
- 一次专注做好一个小事。
- 不扫一屋 何以扫天下，让自己早睡，早起，锻炼身体，刷牙保持个人卫生，多喝水 ，表达清楚 基本事情做好。
- 我控制 的事情是 我通过写自己代码拿到百万收益。代码就是杠杆，我必须创造可以运行在2c2g云主机小而美产品出来（服务普通人），而不是运行构建至少10台*64cpu* 300g内存物理机大而全项目（领航者，超越其他产品，出货全球N1，这个还是有停留有限斗争游戏，为top 10人企业服务）我必须糊涂混沌中走出来










### 参考资料
- # 谷歌云全球服务中断事故深度解析
- 谷歌官方发布的事故报告可通过其云服务平台状态页面直接查看，具体链接如下：  
​**​🔗 官方报告地址​**​：  
https://status.cloud.google.com/incidents/ow5i3PPK96RduMcb1SsW

### 报告关键信息摘要：

1. ​**​事故时间​**​
    - 2025年6月12日（太平洋夏令时10:49开始，持续约3-7小时）
        
        3
        
        7
        
        8
        
        。
2. ​**​根本原因​**​
    - 5月29日新增的配额策略检查功能存在空指针漏洞，且未启用功能标志（Feature Flags）保护
        
        3
        
        4
        
        7
        
        。
    - 6月12日策略变更中的空白字段触发该漏洞，导致核心组件Service Control全球崩溃
        
        3
        
        7
        
        。
3. ​**​影响范围​**​
    - ​**​全球70+项服务​**​：谷歌云自身服务（Gmail、Meet等）及Cloudflare、OpenAI等第三方平台
        
        1
        
        2
        
        6
        
        。
    - ​**​经济损失​**​：Alphabet股价下跌，全球20%互联网流量受阻
        
        1
        
        9
        
        。
4. ​**​改进措施​**​
    - 强制功能标志保护、模块化架构解耦、完善故障重试机制