---
title: "实践练习六（必选）：查看 OceanBase 执行计划"
date: 2022-01-28
draft: false
categories: ["code_reading"]
---



> 多看、多问、多总结，肯定是可以攻克的。



文章结构 



http://127.0.0.1:1313/post/oceanbase/2022-1-28/



实践练习六（必选）：查看 OceanBase 执行计划



## 环境说明



~~~shell
obd cluster display test
+---------------------------------------------+
|                   observer                  |
+-----------+---------+------+-------+--------+
| ip        | version | port | zone  | status |
+-----------+---------+------+-------+--------+
| 127.0.0.1 | 3.1.1   | 2881 | zone1 | active |
+-----------+---------+------+-------+--------+

 /etc/sysctl.conf 
 fs.aio-max-nr = 1048576 ##文件系统最大异步io
 fs.file-max = 6815744 ##文件系统中文件的最大个数
~~~





### 一、 使用 BenmarkSQL 运行 TPC-C 



### 1.1操作过程

~~~shell
## 网络环境配置
vi /etc/hosts //去掉github host设置，很难加速

##java环境配置
yum install java-1.8.0-openjdk  java-1.8.0-openjdk-devel  
java  -version
openjdk version "1.8.0_322"
## 下载benchmarksql
git clone https://github.com/obpilot/benchmarksql-5.0.git

## 这里没有obproxy jdbc 2283改为2281
//https://github.com/oceanbase/obdeploy/blob/master/example/single-with-obproxy-example.yaml
vi props.ob


##建表

./runSQL.sh props.ob ./sql.oceanbase/tableCreates.sql



~~~







### 1.2 通过操作了解概念

> 视频资料：
>
>  OceanBase 功能和性能测试概述 
>
> https://open.oceanbase.com/docs/videoCenter/5900011





BenchmarkSQL是对**OLTP**数据库主流测试标准TPC-C的开源实现。目前最新版本为V5.0

该版本支持Firebird， Oracle和PostgreSQL

- 小王疑问：**TPC-C:**和TPC-H就差一个字，有什么区别？

![TPC-C](https://images.gitee.com/uploads/images/2022/0129/105307_c2f8238b_116887.png )
![TPC-H](https://images.gitee.com/uploads/images/2022/0129/105405_eb361c8a_116887.png)

- 小王疑问。如何支持OceanBase？

 BenchmarkSQL是通过jdbc连接各个数据库的。

需要下载客户连接jar lib/oracle/oceanbase-client-1.0.9.jar

 obpilot已经完成。

add oceanbase configuration file (run/props.ob) and sql scripts (run/sql.oceanbase/*.sql) .



- 小王疑问 HOW-TO-RUN.txt 测试？

  https://github.com/obpilot/benchmarksql-5.0/blob/master/HOW-TO-RUN.txt



![测试](https://images.gitee.com/uploads/images/2022/0129/112609_d287c7ee_116887.png)

~~~scala

db=oracle
driver=com.alipay.oceanbase.obproxy.mysql.jdbc.Driver
conn=jdbc:oceanbase://127.1:2881/tpcc?useUnicode=true&characterEncoding=utf-8
user=tpcc@oracle0_85#obv22_stable
password=123456

warehouses=2 //仓库数
loadWorkers=2//数据加载的性能

terminals=2 //客户端并发数
//To run specified transactions per terminal- runMins must equal zero
runTxnsPerTerminal=0
//To run for specified minutes- runTxnsPerTerminal must equal zero
runMins=1 //压测时间
//Number of total transactions per minute
limitTxnsPerMin=0

//Set to true to run in 4.x compatible mode. Set to false to use the
//entire configured database evenly.
terminalWarehouseFixed=true

//The following five values must add up to 100
newOrderWeight=45
paymentWeight=43
orderStatusWeight=4
deliveryWeight=4
stockLevelWeight=4

// Directory name to create for collecting detailed result data.
// Comment this out to suppress.
resultDirectory=my_result_%tY-%tm-%td_%tH%tM%tS
osCollectorScript=./misc/os_collector_linux.py
osCollectorInterval=1

~~~





## 二、分析 TPC-C TOP SQL，并查看 3条 SQL 的 解析执行计划 和 实际执行计划。













### **参考资料**

- 社区版官网-文档-学习中心-入门教程：[OceanBase 入门到实战教程](https://open.oceanbase.com/docs/tutorials/quickstart/V1.0.0/chapter-1-overview-of-the-oceanbase-database)
- 社区版官网-博客-入门实战：[开源博客](https://open.oceanbase.com/blog)
- 实践练习六（必选）：查看 OceanBase 执行计划 https://open.oceanbase.com/answer/detail?id=20400276&search=&pageNum=1&sou=0a00
- [OceanBase 社区版入门到实战教](https://open.oceanbase.com/blog/10900164?currentPage=1
- [3]  OceanBase 2.2 版本体验：用 BenchmarkSQL 跑 TPC-Chttps://zhuanlan.zhihu.com/p/112894850
- [4] 视频：https://open.oceanbase.com/docs/videoCenter
- [5] 文档：7.1 OceanBase 数据库 SQL 诊断和优化

   https://open.oceanbase.com/docs/videoCenter/5900015

- 【6】Oceanbase TPCC性能压测 https://www.modb.pro/db/26092 【20%】

