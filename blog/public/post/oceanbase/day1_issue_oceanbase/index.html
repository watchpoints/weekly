<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>OceanBase开发者手册 - Troy的网络博客</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Troy" /><meta name="description" content="OceanBase开发者手册" /><meta name="keywords" content="daily-interview-question, Github, c&#43;&#43;, Leetcode 题解, 后端面试" />






<meta name="generator" content="Hugo 0.83.1 with theme even" />


<link rel="canonical" href="https://wangcy6.github.io/post/oceanbase/day1_issue_oceanbase/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<link href="/dist/even.c2a46f00.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="OceanBase开发者手册" />
<meta property="og:description" content="OceanBase开发者手册" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://wangcy6.github.io/post/oceanbase/day1_issue_oceanbase/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-02-23T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2022-02-23T00:00:00&#43;00:00" />

<meta itemprop="name" content="OceanBase开发者手册">
<meta itemprop="description" content="OceanBase开发者手册"><meta itemprop="datePublished" content="2022-02-23T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2022-02-23T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="4567">
<meta itemprop="keywords" content="OceanBase," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="OceanBase开发者手册"/>
<meta name="twitter:description" content="OceanBase开发者手册"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->
<script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css">
</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Even</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">首页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">分类</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">标签</li>
      </a><a href="https://github.com/wangcy6/weekly/tree/master/book">
        <li class="mobile-menu-item">阅读清单</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">关于我</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Even</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">首页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">分类</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">标签</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="https://github.com/wangcy6/weekly/tree/master/book">阅读清单</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">关于我</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">OceanBase开发者手册</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-02-23 00:00 </span>
        
          <span class="more-meta"> 约 4567 字 </span>
          <span class="more-meta"> 预计阅读 10 分钟 </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 次阅读 </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#day1-阅读oceanbase开发者手册httpsgithubcomoceanbaseoceanbasedeveloper-manual">day1: 阅读：<a href="https://github.com/oceanbase/oceanbase#developer-manual">OceanBase开发者手册</a></a>
      <ul>
        <li><a href="#11-开发环境说明极简版">1.1 开发环境说明(极简版)</a></li>
        <li><a href="#12-macos-下使用-docker-搭建-centos-开发环境">1.2 macOS 下使用 Docker 搭建 centos 开发环境</a></li>
        <li><a href="#13oceanbase开发者手册之二-如何设置ide开发环境done">1.3《OceanBase开发者手册》之二 如何设置IDE开发环境（done）</a></li>
      </ul>
    </li>
    <li><a href="#14-vscode设置">1.4 vscode设置</a>
      <ul>
        <li><a href="#15-oceanbase开发者手册之三-如何成为oceanbase-contributorhttpsgithubcomoceanbaseoceanbasewikihow_to_contribute">1.5 <a href="https://github.com/oceanbase/oceanbase/wiki/how_to_contribute">《OceanBase开发者手册》之三 如何成为OceanBase Contributor</a></a></li>
        <li><a href="#16-oceanbase开发者手册之五-如何debug-oceanbasehttpsgithubcomoceanbaseoceanbasewikihow_to_debug">1.6 <a href="https://github.com/oceanbase/oceanbase/wiki/how_to_debug">《OceanBase开发者手册》之五 如何debug OceanBase</a></a></li>
      </ul>
    </li>
    <li><a href="#day2-阅读-roadmap">day2: 阅读 Roadmap</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <blockquote>
<p>多看、多问、多总结</p>
</blockquote>
<table>
<thead>
<tr>
<th>日期</th>
<th>内容</th>
<th>版本</th>
</tr>
</thead>
<tbody>
<tr>
<td>2022-2-23</td>
<td>day1:</td>
<td>v1  勉强可以用。</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>blog地址：https://wangcy6.github.io/post/oceanbase/day1_issue_oceanbase/</p>
<h2 id="day1-阅读oceanbase开发者手册httpsgithubcomoceanbaseoceanbasedeveloper-manual">day1: 阅读：<a href="https://github.com/oceanbase/oceanbase#developer-manual">OceanBase开发者手册</a></h2>
<p>使用VSCode 远程链接功能阅读OceanBase代码</p>
<p><img src="https://s2.loli.net/2022/02/23/qgrFLh3ZSbD7zXv.png" alt="image.png"></p>
<p><strong>我们经常遇到两个问题：</strong></p>
<ol>
<li>本地电脑存在瓶颈，单机性能有限，毕竟资金紧缺？</li>
<li>一般电脑安装的都是 windows 或者 mac 图形支撑好的系统，而开发的项目又必须是 Linux 上编译运行？</li>
</ol>
<p>如果本机直接用 vscode ，势必会遇到上面的问题。比如 Linux/OceanBase 代码量巨大，本机性能是 hold 不住，编辑器建立内存的索引非常庞大，既要吃内存又要吃 CPU 。对于编译，那就更麻烦了，涉及到手动的同步。</p>
<p><strong>我们经常怎么解决它？</strong></p>
<ol>
<li>纵向优化电脑，给自己电脑加个内存条，换个 cpu ，这个思路是可以的，但是它永远存在性能瓶颈。这还真不是钱的问题；</li>
<li>对于平台依赖，以前的实践是 windows 下编辑，然后用 scp 或者其他同步工具，把代码同步到另外一台 Linux 下去编译，很麻烦；</li>
</ol>
<p><strong>怎么才能彻底解决它？</strong></p>
<h3 id="11-开发环境说明极简版">1.1 开发环境说明(极简版)</h3>
<ul>
<li>
<p>因为公司没有合适机器 4C12G ,上次偷偷使用一次导致服务器cpu利用过高被邮件告警，必须采取个人mac作为开发。</p>
</li>
<li>
<p>官方提供docker 4C10G,普通笔记本也无法使用，这里采用4C4G方式进行开发编译。</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">Make sure the available resources meet the requirements:
The logical CPU count is no less than 4.
The available memory is no less than 10G, and the docker container memory limit is no less than 10G.
The available disk space is no less than 10G.
请确保宿主机的可用资源满足下面要求：
逻辑 CPU 不少于4个
可用内存不少于 10G，并且 docker 容器内存限制不少于10G
空间不少于10G
https://hub.docker.com/r/obpilot/oceanbase-ce
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>小贴士：可以直接使用官方提供docker进行开发。</p>
</blockquote>
<p><a href="https://www.mdnice.com/writing/fdb7307bd3d44275963567191b93c742">实践练习一（必选）：OceanBase Docker 体验</a></p>
<h3 id="12-macos-下使用-docker-搭建-centos-开发环境">1.2 macOS 下使用 Docker 搭建 centos 开发环境</h3>
<ul>
<li>参考： <a href="https://github.com/oceanbase/oceanbase/wiki/how_to_build">《OceanBase开发者手册》之一 如何编译OceanBase源码</a></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1">## centos镜像</span>
https://github.com/watchpoints/mydocker
docker pull oceanbase/centos7:latest

docker run -itd  -p 2881:2881 -p 22:22 --privileged<span class="o">=</span><span class="nb">true</span>  --name oceanbase-ce oceanbase/centos7 /bin/bash
docker <span class="nb">exec</span> -it oceanbase-ce bash

yum-config-manager --add-repo http://mirrors.aliyun.com/repo/Centos-7.repo
yum-config-manager --add-repo https://mirrors.aliyun.com/oceanbase/OceanBase.repo
ifconfig安装
yum install net-tools.x86_64
yum install m4


<span class="c1">##SSH公钥认证方式远程登陆docker容器</span>
vi /etc/ssh/sshd_config
PermitRootLogin yes <span class="c1">##允许root用户以任何认证方式登录（用户名密码认证和公钥认证）</span>
<span class="c1">#PermitRootLogin yes #允许root用户以任何认证方式登录（用户名密码认证和公钥认证）</span>
<span class="c1">#PermitRootLogin without-password #只允许root用公钥认证方式登录</span>
<span class="c1">#PermitRootLogin no #不允许root用户以任何认证方式登录</span>

PasswordAuthentication yes
RSAAuthentication yes
PubkeyAuthentication yes <span class="c1">#启用公钥私钥配对认证方式</span>
<span class="c1">#AuthorizedKeysFile .ssh/authorized_keys #公钥文件路径（和上面生成的文件同）</span>
passwd root


登录操作：
docker attach  3346da816048
docker <span class="nb">exec</span> -it oceanbase-ce bash
service sshd restart
chkconfig sshd on
ssh root@10.2.131.60 -p <span class="m">22</span> （ mac 网络方式变化 宿主机器IP）
ssh root@192.168.4.106 -p <span class="m">22</span>  （mac 网络方式变化 宿主机器IP）






<span class="c1">## 编译</span>


docker <span class="nb">exec</span> -it oceanbase-ce bash
service sshd restart
cat /root/.ssh/id_rsa.pub

git clone git@github.com:watchpoints/oceanbase.git （下载超慢!!!）
git config --global user.name <span class="s2">&#34;watchpoints&#34;</span>
git config --global user.email <span class="s2">&#34;wang_cyi@163.com&#34;</span>

debug mode
bash build.sh debug --init --make

<span class="c1"># 执行build.sh脚本并传入init参数</span>
sh build.sh init //更新依赖的第三方库。


<span class="c1"># 在源码目录下执行debug版的预制构建命令</span>
yum install m4
sh build.sh debug
<span class="c1"># 进入生成的 debug 构建目录</span>
<span class="nb">cd</span> build_debug
<span class="c1"># 进行构建</span>
make -j<span class="o">{</span>N<span class="o">}</span> observer <span class="o">(</span>需要很长时间<span class="o">)</span>
<span class="c1"># 查看构建产物</span>
stat src/observer/observer



--基于新镜像运行容器
docker run -d -p 10022:22 herong/centos7-ssh:latest /usr/sbin/sshd -D

</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>遗留问题 缺点：每次重启 service sshd restart 因此 需要重新构造一个镜像。这里还没有实现。</p>
</blockquote>
<blockquote>
<p>遗留问题：将服务器目录与容器目录进行共享 这个可以设置。</p>
</blockquote>
<h3 id="13oceanbase开发者手册之二-如何设置ide开发环境done">1.3《OceanBase开发者手册》之二 如何设置IDE开发环境（done）</h3>
<ul>
<li>vscode &ndash;已经下载完毕</li>
<li>clang-format是clang（一个面向C系语言的轻量级编译器）中一个工具，主要负责代码的格式化和排版工作 &ndash;已经设置完毕。</li>
<li>/Users/wangchuanyi/code/src/oceanbase/<a href="https://raw.githubusercontent.com/oceanbase/oceanbase/master/.clang-format">.clang-format</a> 已经存在不需要处理</li>
</ul>
<h2 id="14-vscode设置">1.4 vscode设置</h2>
<ul>
<li><strong>vscode 远程连接主机主要是依赖于微软提供的插件 Remote-SSH。</strong></li>
</ul>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/4UtmXsuLoNfrjwr6vCeRTaL3kQLG1CZczQcITn3lW8brVQQav8ujicZuq2XKkSEbfkOcdTlsPuzCPHxnicPYic5vw/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt=""></p>
<h3 id="15-oceanbase开发者手册之三-如何成为oceanbase-contributorhttpsgithubcomoceanbaseoceanbasewikihow_to_contribute">1.5 <a href="https://github.com/oceanbase/oceanbase/wiki/how_to_contribute">《OceanBase开发者手册》之三 如何成为OceanBase Contributor</a></h3>
<blockquote>
<p>如何去参与一个开源库的开发 提交doc 修改为例子</p>
</blockquote>
<ul>
<li>一个issue 一个分支</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">docker <span class="nb">exec</span> -it oceanbase-ce bash
service sshd restart
ssh root@10.2.131.60 -p <span class="m">22</span> （宿主机器IP）

<span class="c1">## 关联远程仓库，保证代码可以和远程更新和提交</span>
git remote add oceanbase https://github.com/oceanbase/oceanbase.git
git remote -v
<span class="c1">#把远程仓库最新的代码及分支拉取一下 </span>
git fetch oceanbase 
git merge oceanbase/master
<span class="c1"># git merge 远程仓库的别名/分支名 （一般不这样做）</span>
git merge upstream/issue_557
git checkout -b issue_557 origin/issue_557

<span class="c1">#查看远程分支</span>
git branch -r 
git branch -a


<span class="c1">## 本地创建分支，进行开发</span>
git checkout -b issue_557
git checkout -b issue_558

<span class="c1">## 提交</span>
当前分支推送到自己的远程仓库
100%<span class="o">]</span> Linking CXX static library liboceanbase_static.a
<span class="o">[</span>100%<span class="o">]</span> Built target oceanbase_static
<span class="o">[</span>100%<span class="o">]</span> Linking CXX executable observer

git commit -m <span class="s2">&#34;fix typos ocena-&gt;ocean #646&#34;</span>
git push -u  origin issue_558 //1.8.1

<span class="c1">## 冲突解决</span>
git reset --hard HEAD  （不建议）


https://github.com/oceanbase/oceanbase/issues/646 为例子 提交pr

</code></pre></td></tr></table>
</div>
</div><h3 id="16-oceanbase开发者手册之五-如何debug-oceanbasehttpsgithubcomoceanbaseoceanbasewikihow_to_debug">1.6 <a href="https://github.com/oceanbase/oceanbase/wiki/how_to_debug">《OceanBase开发者手册》之五 如何debug OceanBase</a></h3>
<ul>
<li>1.6.1 准备工作 【开始 50】</li>
</ul>
<p>一、小思考</p>
<p>Q: <a href="https://github.com/oceanbase/obdeploy">How can I use a component of a specific version?</a></p>
<p>最低配置是多少？</p>
<p>vscode 运行一个程序为什么需要launch文件？</p>
<p>二、过程</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">
<span class="c1">#1. 官方提供2C8G参考配置 https://github.com/oceanbase/oceanbase/pull/787(2C8G)</span>

https://github.com/oceanbase/obdeploy
Your server has at least <span class="m">8</span> GB of memory.
Your server has at least <span class="m">2</span> CPU cores.

RUN sh build.sh debug --init <span class="se">\
</span><span class="se"></span>    <span class="o">&amp;&amp;</span> sh build.sh --make -j4 <span class="se">\
</span><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build_debug <span class="se">\
</span><span class="se"></span>    <span class="o">&amp;&amp;</span> make <span class="nv">DESTDIR</span><span class="o">=</span>. install <span class="se">\
</span><span class="se"></span>    <span class="o">&amp;&amp;</span> obd mirror create -n oceanbase-ce -V 100.0.0 -p ./usr/local -t <span class="nb">test</span> -f
    
    
docker <span class="nb">exec</span> -it oceanbase-ce bash
service sshd restart
ssh root@10.2.131.60 -p <span class="m">22</span> （宿主机器IP）


observer -r xxx.xxx.xxx.xxx:2882:2881 -o <span class="nv">__min_full_resource_pool_memory</span><span class="o">=</span>268435456,enable_syslog_recycle<span class="o">=</span>True,enable_syslog_wf<span class="o">=</span>True,max_syslog_file_count<span class="o">=</span>4,memory_limit<span class="o">=</span>69G,system_memory<span class="o">=</span>27G,cpu_count<span class="o">=</span>19,datafile_size<span class="o">=</span>1029G,clog_disk_utilization_threshold<span class="o">=</span>95,clog_disk_usage_limit_percentage<span class="o">=</span><span class="m">98</span> -z zone1 -p <span class="m">2881</span> -P <span class="m">2882</span> -n obcluster -c <span class="m">1</span> -d /home/xxxxxxx/observer/store -i em1 -l INFO

https://gitee.com/oceanbase/obdeploy/blob/master/example/mini-local-example.yaml


obd cluster deploy obtest -c mini-local-example.yaml
obd cluster edit-config obtest
obd cluster redeploy obtest

obd cluster list
obd cluster display obtest
obd cluster start  obtest

obclient -uroot@sys -h127.0.0.1 -P2881 oceanbase

//
observer program health check x
<span class="o">[</span>2022-02-25 02:30:19.076440<span class="o">]</span> WARN  <span class="o">[</span>SHARE<span class="o">]</span> add_extra_config <span class="o">(</span>ob_common_config.cpp:100<span class="o">)</span> <span class="o">[</span>1476<span class="o">][</span>0<span class="o">][</span>Y0-0000000000000000<span class="o">]</span> <span class="o">[</span><span class="nv">lt</span><span class="o">=</span>20<span class="o">]</span> Invalid config, value out of range<span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">&#34;memory_limit&#34;</span>, <span class="nv">value</span><span class="o">=</span><span class="s2">&#34;6G&#34;</span>, <span class="nv">ret</span><span class="o">=</span>-4147<span class="o">)</span>

const int64_t ObRunningModeConfig::MINI_MEM_LOWER <span class="o">=</span> 8L <span class="s">&lt;&lt; 30;
</span><span class="s">const int64_t ObRunningModeConfig::MINI_MEM_UPPER = 16L &lt;&lt; 30</span><span class="p">;</span>

Invalid config, value out of range<span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">&#34;memory_limit&#34;</span>, <span class="nv">value</span><span class="o">=</span><span class="s2">&#34;6G&#34;</span>, <span class="nv">ret</span><span class="o">=</span>-4147<span class="o">)</span>

int64_t ObRunningModeConfig::MINI_MEM_LOWER <span class="o">=</span> 8L <span class="s">&lt;&lt; 30;
</span><span class="s">
</span><span class="s">obclient -uroot@sys -h127.0.0.1 -P2881 oceanbase
</span><span class="s">
</span><span class="s">[root@3346da816048 ~]# obclient -uroot@sys -h127.0.0.1 -P2881 oceanbase
</span><span class="s">Reading table information for completion of table and column names
</span><span class="s">You can turn off this feature to get a quicker startup with -A
</span><span class="s">
</span><span class="s">Welcome to the OceanBase.  Commands end with ; or \g.
</span><span class="s">Your MySQL connection id is 3221487661
</span><span class="s">Server version: 5.7.25 OceanBase 3.1.2 (r100003920211230</span>10-d4ace121deae5b81d8f0b40afbc4c02705b7fc1d<span class="o">)</span> <span class="o">(</span>Built Dec <span class="m">30</span> <span class="m">2021</span> 02:47:29<span class="o">)</span>

Copyright <span class="o">(</span>c<span class="o">)</span> 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type <span class="s1">&#39;help;&#39;</span> or <span class="s1">&#39;\h&#39;</span> <span class="k">for</span> help. Type <span class="s1">&#39;\c&#39;</span> to clear the current input statemen

捕获oceanbase 的启动参数 <span class="o">(</span>通过‘ps -ef<span class="p">|</span>grep observer’<span class="o">)</span>.

/root/observer/bin/observer -r 127.0.0.1:2882:2881 -o <span class="nv">__min_full_resource_pool_memory</span><span class="o">=</span>268435456,memory_limit<span class="o">=</span>8G,system_memory<span class="o">=</span>4G,stack_size<span class="o">=</span>512K,cpu_count<span class="o">=</span>16,cache_wash_threshold<span class="o">=</span>1G,workers_per_cpu_quota<span class="o">=</span>10,schema_history_expire_time<span class="o">=</span>1d,net_thread_count<span class="o">=</span>4,sys_bkgd_migration_retry_num<span class="o">=</span>3,minor_freeze_times<span class="o">=</span>10,enable_separate_sys_clog<span class="o">=</span>0,enable_merge_by_turn<span class="o">=</span>False,datafile_disk_percentage<span class="o">=</span>20,enable_syslog_wf<span class="o">=</span>False,enable_syslog_recycle<span class="o">=</span>True,max_syslog_file_count<span class="o">=</span><span class="m">4</span> -z zone1 -p <span class="m">2881</span> -P <span class="m">2882</span> -c <span class="m">1</span> -d /root/observer/store -i lo -l INFO


资料：https://github.com/oceanbase/oceanbase/wiki/how_to_debug

摘要：
remote ssh 连接远程机器
插件：
C/C++ GNU Global
C/C++

OB_SRC_DIR：
<span class="c1">###########################</span>
<span class="c1"># 动态库  /etc/ld.so.conf</span>
<span class="c1">#####################</span>
<span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$LD_LIBRARY_PATH</span>:/usr/local/lib

<span class="c1">###########################</span>
<span class="c1">#  环境变量</span>
<span class="c1">#####################</span>
<span class="nb">export</span> <span class="nv">OB_SRC_DIR</span><span class="o">=</span>//app//oceanbase
<span class="nb">export</span> <span class="nv">IP</span><span class="o">=</span>127.0.0.1

<span class="c1">###########################</span>
<span class="c1">#  别名</span>
<span class="c1">#####################</span>
<span class="nb">alias</span> <span class="nv">c</span><span class="o">=</span><span class="s2">&#34;source ~/.bashrc&#34;</span>
<span class="nb">alias</span> <span class="nv">cdcode</span><span class="o">=</span><span class="s2">&#34;cd /home/work/dns_zhibo&#34;</span>


OBServer 启动失败
https://open.oceanbase.com/docs/tutorials-cn/V1.0.0/10000000000012304
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>配置:</p>
<blockquote>
<p>小贴士：</p>
<p>文档默认64G配置，不能直接拿来用，要改成自己的</p>
</blockquote>
</li>
</ul>
<p>/root/observer/bin/observer -r 127.0.0.1:2882:2881 -o __min_full_resource_pool_memory=268435456,memory_limit=8G,system_memory=4G,stack_size=512K,cpu_count=16,cache_wash_threshold=1G,workers_per_cpu_quota=10,schema_history_expire_time=1d,net_thread_count=4,sys_bkgd_migration_retry_num=3,minor_freeze_times=10,enable_separate_sys_clog=0,enable_merge_by_turn=False,datafile_disk_percentage=20,enable_syslog_wf=False,enable_syslog_recycle=True,max_syslog_file_count=4 -z zone1 -p 2881 -P 2882 -c 1 -d /root/observer/store -i lo -l INFO</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">{
    // Use IntelliSense to learn about possible attributes.
    // Hover to view descriptions of existing attributes.
    // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387
    &#34;version&#34;: &#34;0.2.0&#34;,
    &#34;configurations&#34;: [
    
        {
            &#34;name&#34;: &#34;observer&#34;,
            &#34;type&#34;: &#34;cppdbg&#34;,
            &#34;request&#34;: &#34;launch&#34;,
            &#34;program&#34;: &#34; /root/observer/build_debug/src/observer/observer&#34;,
            &#34;args&#34;: [&#34;-r&#34;, &#34;127.0.0.1:2882:2881&#34;, &#34;-o&#34;, &#34;__min_full_resource_pool_memory=268435456,memory_limit=8G,system_memory=4G,stack_size=512K,cpu_count=16,cache_wash_threshold=1G,workers_per_cpu_quota=10,schema_history_expire_time=1d,net_thread_count=4,sys_bkgd_migration_retry_num=3,minor_freeze_times=10,enable_separate_sys_clog=0,enable_merge_by_turn=False,datafile_disk_percentage=20,enable_syslog_wf=False,enable_syslog_recycle=True,max_syslog_file_count=4&#34;, &#34;-z&#34;, &#34;zone1&#34;, &#34;-p&#34;, &#34;2881&#34;, &#34;-P&#34;, &#34;2882&#34;, &#34;-n&#34;, &#34;obcluster&#34;, &#34;-c&#34;, 1, &#34;-d&#34;, &#34;/root/observer/store&#34;, &#34;-i&#34;, &#34;lo&#34;, &#34;-l&#34;, &#34;INFO&#34;],
            &#34;stopAtEntry&#34;: true,
            &#34;cwd&#34;: &#34; /root/observer&#34;,
            &#34;environment&#34;: [],
            &#34;externalConsole&#34;: false,
            &#34;MIMode&#34;: &#34;gdb&#34;,
            &#34;setupCommands&#34;: [
                {
                    &#34;description&#34;: &#34;Enable pretty-printing for gdb&#34;,
                    &#34;text&#34;: &#34;-enable-pretty-printing&#34;,
                    &#34;ignoreFailures&#34;: true
                },
                {
                    &#34;description&#34;: &#34;将反汇编风格设置为 Intel&#34;,
                    &#34;text&#34;: &#34;-gdb-set disassembly-flavor intel&#34;,
                    &#34;ignoreFailures&#34;: true
                }
            ]
        }
    ]
}

{
    // 使用 IntelliSense 了解相关属性。 
    // 悬停以查看现有属性的描述。
    // 欲了解更多信息，请访问: https://go.microsoft.com/fwlink/?linkid=830387
    &#34;version&#34;: &#34;0.2.0&#34;,
    &#34;configurations&#34;: [
        {
            &#34;name&#34;: &#34;(gdb) 启动&#34;,
            &#34;type&#34;: &#34;cppdbg&#34;,
            &#34;request&#34;: &#34;launch&#34;,
            &#34;program&#34;: &#34;输入程序名称，例如 ${workspaceFolder}/a.out&#34;,
            &#34;args&#34;: [],
            &#34;stopAtEntry&#34;: false,
            &#34;cwd&#34;: &#34;${fileDirname}&#34;,
            &#34;environment&#34;: [],
            &#34;externalConsole&#34;: false,
            &#34;MIMode&#34;: &#34;gdb&#34;,
            &#34;setupCommands&#34;: [
                {
                    &#34;description&#34;: &#34;为 gdb 启用整齐打印&#34;,
                    &#34;text&#34;: &#34;-enable-pretty-printing&#34;,
                    &#34;ignoreFailures&#34;: true
                },
                {
                    &#34;description&#34;: &#34;将反汇编风格设置为 Intel&#34;,
                    &#34;text&#34;: &#34;-gdb-set disassembly-flavor intel&#34;,
                    &#34;ignoreFailures&#34;: true
                }
            ]
        }
    ]
}
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>clion 本地调试【遗留问题】</p>
<p>据说它的源码索引效率优于sourceInsight几倍。这里没有使用</p>
</li>
</ul>
<p><a href="https://www.jetbrains.com/zh-cn/clion/">https://www.jetbrains.com/zh-cn/clion/</a></p>
<ul>
<li>直接用gdb 本地调试 [ 在linx 环境下运行 done]</li>
</ul>
<ol>
<li>登录remote 机器, 并进入${OB_SRC_DIR} 源码目录</li>
<li>参考之前文章 介绍 《如何编译OceanBase源码》</li>
<li>修改 用户目录下的.gdbinit, 添加下面一行, 其中${OB_SRC_DIR}需要换成OB 源码根目录</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">add-auto-load-safe-path ${OB_SRC_DIR}/.gdbinit
</code></pre></td></tr></table>
</div>
</div><ol>
<li>vi ${OB_SRC_DIR}/.gdbinit</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">file build_debug/src/observer/observer
set args &#34;-r&#34;, &#34;127.0.0.1:2882:2881&#34;, &#34;-o&#34;, &#34;___min_full_resource_pool_memory=268435456,memory_limit=8G,system_memory=4G,stack_size=512K,cpu_count=16,cache_wash_threshold=1G,workers_per_cpu_quota=10,schema_history_expire_time=1d,net_thread_count=4,sys_bkgd_migration_retry_num=3,minor_freeze_times=10,enable_separate_sys_clog=0,enable_merge_by_turn=False,datafile_disk_percentage=20,enable_syslog_wf=False,enable_syslog_recycle=True,max_syslog_file_count=4&#34;,&#34;-z&#34;, &#34;zone1&#34;, &#34;-p&#34;, &#34;2881&#34;, &#34;-P&#34;, &#34;2882&#34;, &#34;-n&#34;, &#34;obcluster&#34;, &#34;-c&#34;, 1, &#34;-d&#34;, &#34;/root/observer/store&#34;, &#34;-i&#34;, &#34;lo&#34;, &#34;-l&#34;, &#34;INFO&#34;
b main
r
</code></pre></td></tr></table>
</div>
</div><p>备注: 这个里面有args的参数来自于第一步的准备工作中获取的启动参数, 每台机器有每台机器的配置, 笔者的参数如下, 其中:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">1. ${OB_SRC_DIR} 为源码目录, ${IP} 为observer 的绑定ip
2. 需要设置“cwd”, 为${OB_SRC_DIR}
3. 当前的工作目录必须是${OB_SRC_DIR}
4. 在args 参数中, 其中 -d 设置的目录 &#34;/home/xxxxx/observer/store&#34;, 需要设置为真实的参数
5. 在args 参数中, 其中-i 设置的设备名称 &#34;em1&#34;, 为ip 对应的设备名称
</code></pre></td></tr></table>
</div>
</div><ol>
<li>推荐使用tui tui是gdb自带的图形界面，比较直观，这里简单说一下切换方法和常用命令</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">1、gdb -tui + (可执行程序)  直接进入tui图形界面

2、gdb进入后，使用命令focus进入tui图形界面，或者使用快捷键：Ctl+x+a (注意按键顺序，记忆：x：focus，a：another)

3、在tui中使用相同的快捷键Ctl+x+a返回到gdb原生界面

4、在gdb中↑和↓切换上一个命令和下一个命令，但是在tui中只是控制代码视图。想达到切换命令的目的，使用Ctl+n （记忆：next）和Ctl+p（记忆：previous），这其实就是gdb的原生快捷键
</code></pre></td></tr></table>
</div>
</div><ol>
<li>在源码目录下, 敲入gdb 即可启动gdb debug</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">/root/.obd/repository/oceanbase-ce/3.1.1/f19f8bfb67723712175fb0dfd60579196b3168f1/bin/observer


gdb 

gdb进入后，使用命令focus进入tui图形界面，或者使用快捷键：Ctl+x+a (注意按键顺序，记忆：x：focus，a：another)
在tui中使用相同的快捷键Ctl+x+a返回到gdb原生界面


替换：
obd cluster stop test
cd /app/oceanbase/build_debug/src/observer
cp observer /root/.obd/repository/oceanbase-ce/3.1.1/f19f8bfb67723712175fb0dfd60579196b3168f1/bin/observer


问：[如何设置断点跟踪](https://open.oceanbase.com/answer/detail?id=20400433)

答：

- gdb Function  not defined. 是因为自己设置符号不存在。
- 改为thread apply all break obmp_query.cpp:84 解决



dbgui：基于浏览器的gdb前端（gnu调试器）。 使用C，C ++，Go，Rust和F

obclient -uroot@tpcc -h127.0.0.1 -P2881 -p123456 -Dtpcc
obclient -uroot@tpcc -h127.0.0.1 -P2881 -p123456 -Dtpcc



obclient -uroot@tpcc -h127.0.0.1 -P2881 -p123456 -Dtpcc
gdb设置代码目录
dir /app/oceanbase/ //No such file or directory.

(gdb) delete
Delete all breakpoints? (y or n) y

thread apply all break ob_sql.cpp:1139

直接用gdb 本地调试

/app/data/observer/bin/observer -r 127.0.0.1:2882:2881 -o __min_full_resource_pool_memory=268435456,memory_limit=10G,system_memory=4G,stack_size=512K,cpu_count=12,cache_wash_threshold=1G,workers_per_cpu_quota=10,schema_history_expire_time=1d,net_thread_count=4,sys_bkgd_migration_retry_num=3,minor_freeze_times=10,enable_separate_sys_clog=0,enable_merge_by_turn=False,datafile_disk_percentage=20,enable_syslog_recycle=True,max_syslog_file_count=4,clog_disk_utilization_threshold=10 -z zone1 -p 2881 -P 2882 -c 1 -d /app/data/observer/store -i lo -l WARN


vi ${OB_SRC_DIR}/.gdbinit

file build_debug/src/observer/observer
set args &#34;-r&#34;, &#34;127.0.0.1:2882:2881&#34;, &#34;-o&#34;, &#34;__min_full_resource_pool_memory=268435456,memory_limit=10G,system_memory=4G,stack_size=512K,cpu_count=12,cache_wash_threshold=1G,workers_per_cpu_quota=10,schema_history_expire_time=1d,net_thread_count=4,sys_bkgd_migration_retry_num=3,minor_freeze_times=10,enable_separate_sys_clog=0,enable_merge_by_turn=False,datafile_disk_percentage=20,enable_syslog_recycle=True,max_syslog_file_count=4,clog_disk_utilization_threshold=10&#34;, &#34;-z&#34;,&#34;zone1&#34;,&#34;-p&#34;, &#34;2881&#34;, &#34;-P&#34;, &#34;2882&#34;, &#34;-n&#34;, &#34;obcluster&#34;, &#34;-c&#34;, 1, &#34;-d&#34;, &#34;/app/data/observer/store&#34;, &#34;-i&#34;, &#34;lo&#34;, &#34;-l&#34;, &#34;INFO&#34;
b main
r
add-auto-load-safe-path /app/oceanbase/.gdbinit

export OB_SRC_DIR=//app//oceanbase
export IP=127.0.0.1
////测试不通过

build_debug/src/observer/observer -r 127.0.0.1:2882:2881 -o __min_full_resource_pool_memory=268435456,memory_limit=10G,system_memory=4G,stack_size=512K,cpu_count=12,cache_wash_threshold=1G,workers_per_cpu_quota=10,schema_history_expire_time=1d,net_thread_count=4,sys_bkgd_migration_retry_num=3,minor_freeze_times=10,enable_separate_sys_clog=0,enable_merge_by_turn=False,datafile_disk_percentage=20,enable_syslog_recycle=True,max_syslog_file_count=4,clog_disk_utilization_threshold=10 -z zone1 -p 2881 -P 2882 -c 1 -d /app/data/observer/store -i lo -l WARN




## 设置断点
## PROCESS
dir /app/oceanbase/ 
set pagination off
thread apply all break obmp_query.cpp:100

## handle_physical_plan （(这个断点不能设置)）
thread apply all break ob_sql.cpp:1200
//thread apply all break ob_sql.cpp:3160 （(这个断点不能设置)）
int ObSql::handle_physical_plan

thread apply all break ob_sql.cpp:3217(这个断点不能设置)
else if (OB_FAIL(generate_physical_plan(parse_result, &amp;pc_ctx, context, result))) {

create table sex (sex bit(60) primary key,name bit(60)) partition by hash(sex) partitions 4;

</code></pre></td></tr></table>
</div>
</div><p>阅读：<a href="https://wizardforcel.gitbooks.io/100-gdb-tips/content/config-gdbinit.html">配置gdb init文件</a> 10分钟 ✅</p>
<ul>
<li>当gdb启动时，会读取HOME目录和当前目录下的的配置文件，执行里面的命令。这个文件通常为“.gdbinit”。</li>
</ul>
<p>阅读：<a href="https://blog.csdn.net/nancygreen/article/details/17789677">gdb中查看stl容器内容 1</a>0分钟 ✅</p>
<p><a href="https://github.com/oceanbase/oceanbase/wiki/how_to_test">单元测试</a>  完成。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="n">cd</span> <span class="n">build_debug</span><span class="o">/</span><span class="n">unittest</span><span class="o">/</span>
<span class="n">make</span> <span class="o">-</span><span class="n">j</span> <span class="mi">4</span>
<span class="p">.</span><span class="o">/</span><span class="n">run_tests</span><span class="p">.</span><span class="n">sh</span>
  
<span class="err">整个过程</span><span class="p">,</span> <span class="err">需要</span><span class="mi">1</span><span class="err">个小时</span> <span class="err">太慢了。又优化吗？（</span><span class="n">mac不舍得</span> <span class="err">编译太慢，用其他</span><span class="n">liunx机器代替</span><span class="err">）</span>
</code></pre></td></tr></table>
</div>
</div><p>三 、 结论</p>
<ul>
<li>
<p>docker弹性伸缩 ： 开发环境 2C2G ，配置至少12G（4G其他用，8G observer用）</p>
<p>int64_t ObRunningModeConfig::MINI_MEM_LOWER = 8L &laquo; 30;</p>
</li>
<li>
<p>更好的调试工具 clion 和gdb（界面） 这个做课下作业 没有尝试。后于遇到问题在尝试。</p>
</li>
</ul>
<h2 id="day2-阅读-roadmap">day2: 阅读 Roadmap</h2>
<p><img src="https://github.com/oceanbase/oceanbase/wiki/images/roadmap.jpg" alt=""></p>
<p>gdb 调试 observer</p>
<p><img src="day1_issue_oceanbase.assets/ojGQeLh83bymEr9.png" alt="image.png"></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">
<span class="c1">## 设置代码目录</span>
gdb -p xx
dir /app/oceanbase/ 
<span class="c1">## 设置断点</span>
<span class="c1">## PROCESS</span>
thread apply all <span class="nb">break</span> obmp_query.cpp:100

<span class="c1">## handle_physical_plan</span>
thread apply all <span class="nb">break</span> ob_sql.cpp:1200
thread apply all <span class="nb">break</span> ob_sql.cpp:3160
thread apply all <span class="nb">break</span> ob_sql.cpp:3217


<span class="c1">## tui图形界面</span>
gdb进入后，使用命令focus进入tui图形界面，
或者使用快捷键：Ctl+x+a <span class="o">(</span>注意按键顺序，记忆：x：focus，a：another<span class="o">)</span>
在tui中使用相同的快捷键Ctl+x+a返回到gdb原生界面

<span class="c1">## dbgui：基于浏览器的gdb前端（gnu调试器）。 使用C，C ++，Go，Rust和F</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="day1_issue_oceanbase.assets/urDkBXaGmWygw9O.png" alt="image.png"></p>
<p>sql 入口为例子</p>
<p><img src="day1_issue_oceanbase.assets/KWVP35k29GMyEn1-16462966190124.png" alt="image.png"></p>
<p><img src="day1_issue_oceanbase.assets/meJgcyHBCQp4SPA.png" alt="image.png"></p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">Troy</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2022-02-23 00:00
        
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a target="_blank" rel="license noopener" href="https://github.com/nusr/blog/blob/master/LICENSE">MIT</a></span>
  </p>
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/OceanBase/">OceanBase</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/mysql/day1_mysql_demo/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">mysql内核学习过程</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/oceanbase/obcp/">
            <span class="next-text nav-default">OBCP考试</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  
    <script src="https://utteranc.es/client.js"
            repo="wangcy6/wangcy6.github.io"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:wang_cyi@163.com" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/wangcy6" class="iconfont icon-github" title="github"></a>
  <a href="https://wangcy6.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> 本站总访问量 <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 次 </span>
      <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> 本站总访客数 <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 人 </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2017 - 
    2022
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Troy</span>
  </span>
</div>
<script src="https://cdn.jsdelivr.net/gh/stevenjoezhang/live2d-widget/autoload.js"></script>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.min.js" integrity="sha256-jwCP0NAdCBloaIWTWHmW4i3snUNMHUNO+jr9rYd2iOI=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.locales.min.js" integrity="sha256-ZwofwC1Lf/faQCzN7nZtfijVV6hSwxjQMwXL4gn9qU8=" crossorigin="anonymous"></script>
  <script><!-- NOTE: timeago.js uses the language code format like "zh_CN" (underscore and case sensitive) -->
    var languageCode = "zh-cn".replace(/-/g, '_').replace(/_(.*)/, function ($0, $1) {return $0.replace($1, $1.toUpperCase());});
    timeago().render(document.querySelectorAll('.timeago'), languageCode);
    timeago.cancel();  
  </script>
<script type="text/javascript" src="/dist/even.26188efa.min.js"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-138883536-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>







</body>
</html>
